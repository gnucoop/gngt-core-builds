{"version":3,"file":"core-auth.umd.min.js","sources":["../../src/core/auth/auth-actions.ts","../../node_modules/tslib/tslib.es6.js","../../src/core/auth/auth-api-actions.ts","../../src/core/auth/auth-reducer.ts","../../src/core/auth/login-page-actions.ts","../../src/core/auth/login-page-reducer.ts","../../src/core/auth/reducers.ts","../../src/core/auth/auth-options-token.ts","../../src/core/auth/jwt-options-token.ts","../../src/core/auth/jwt-helper.ts","../../src/core/auth/jwt-interceptor.ts","../../src/core/auth/auth.ts","../../src/core/auth/auth-guard.ts","../../src/core/auth/auth-user-interactions.ts","../../src/core/auth/login.ts","../../src/core/auth/auth-effects.ts","../../src/core/auth/auth-module.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\n\nimport {User} from './user';\n\n\nexport enum AuthActionTypes {\n  Init = '[Auth] Init',\n  InitUser = '[Auth] Init user',\n  InitUserComplete = '[Auth] Init user complete',\n  InitComplete = '[Auth] Init complete',\n  Logout = '[Auth] Logout',\n  LogoutConfirmation = '[Auth] Logout Confirmation',\n  LogoutConfirmationDismiss = '[Auth] Logout Confirmation Dismiss',\n}\n\nexport class Init implements Action {\n  readonly type = AuthActionTypes.Init;\n}\n\nexport class InitUser implements Action {\n  readonly type = AuthActionTypes.InitUser;\n}\n\nexport class InitUserComplete implements Action {\n  readonly type = AuthActionTypes.InitUserComplete;\n\n  constructor(public payload: { user: User | null }) {}\n}\n\nexport class InitComplete implements Action {\n  readonly type = AuthActionTypes.InitComplete;\n}\n\nexport class Logout implements Action {\n  readonly type = AuthActionTypes.Logout;\n}\n\nexport class LogoutConfirmation implements Action {\n  readonly type = AuthActionTypes.LogoutConfirmation;\n}\n\nexport class LogoutConfirmationDismiss implements Action {\n  readonly type = AuthActionTypes.LogoutConfirmationDismiss;\n}\n\nexport type AuthActionsUnion =\n  | Init\n  | InitUser\n  | InitUserComplete\n  | InitComplete\n  | Logout\n  | LogoutConfirmation\n  | LogoutConfirmationDismiss;\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\nimport {LoginResponse} from './login-response';\n\nexport enum AuthApiActionTypes {\n  LoginSuccess = '[Auth/API] Login Success',\n  LoginFailure = '[Auth/API] Login Failure',\n  LoginRedirect = '[Auth/API] Login Redirect',\n  RefreshToken= '[Auth/API] Refresh token'\n}\n\nexport class LoginSuccess implements Action {\n  readonly type = AuthApiActionTypes.LoginSuccess;\n\n  constructor(public payload: LoginResponse) {}\n}\n\nexport class LoginFailure implements Action {\n  readonly type = AuthApiActionTypes.LoginFailure;\n\n  constructor(public payload: { error: any }) {}\n}\n\nexport class LoginRedirect implements Action {\n  readonly type = AuthApiActionTypes.LoginRedirect;\n}\n\nexport class RefreshToken implements Action {\n  readonly type = AuthApiActionTypes.RefreshToken;\n\n  constructor(public payload: { refreshDelay: number, fromInit?: boolean }) {}\n}\n\nexport type AuthApiActionsUnion =\n  | LoginSuccess\n  | LoginFailure\n  | LoginRedirect\n  | RefreshToken;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AuthApiActionsUnion, AuthApiActionTypes} from './auth-api-actions';\nimport * as AuthActions from './auth-actions';\nimport {User} from './user';\n\nexport interface State {\n  init: boolean;\n  user: User | null;\n  token: string | null;\n}\n\nexport const initialState: State = {\n  init: false,\n  user: null,\n  token: null\n};\n\nexport function reducer(\n  state = initialState,\n  action: AuthApiActionsUnion | AuthActions.AuthActionsUnion\n): State {\n  switch (action.type) {\n    case AuthApiActionTypes.LoginSuccess: {\n      return {\n        ...state,\n        user: action.payload.user,\n      };\n    }\n\n    case AuthActions.AuthActionTypes.Logout: {\n      return initialState;\n    }\n\n    case AuthActions.AuthActionTypes.InitUserComplete: {\n      return {\n        ...state,\n        init: true,\n        user: action.payload.user\n      };\n    }\n\n    case AuthActions.AuthActionTypes.InitComplete: {\n      return {\n        ...state,\n        init: true\n      };\n    }\n\n    default: {\n      return state;\n    }\n  }\n}\n\nexport const getInit = (state: State) => state.init;\nexport const getUser = (state: State) => state.user;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\nimport {Credentials} from './credentials';\n\nexport enum LoginPageActionTypes {\n  Login = '[Login Page] Login',\n}\n\nexport class Login implements Action {\n  readonly type = LoginPageActionTypes.Login;\n\n  constructor(public payload: { credentials: Credentials }) {}\n}\n\nexport type LoginPageActionsUnion = Login;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AuthApiActionTypes, AuthApiActionsUnion} from './auth-api-actions';\nimport {LoginPageActionTypes, LoginPageActionsUnion} from './login-page-actions';\n\nexport interface State {\n  error: string | null;\n  pending: boolean;\n}\n\nexport const initialState: State = {\n  error: null,\n  pending: false,\n};\n\nexport function reducer(\n  state = initialState,\n  action: AuthApiActionsUnion | LoginPageActionsUnion\n): State {\n  switch (action.type) {\n    case LoginPageActionTypes.Login: {\n      return {\n        ...state,\n        error: null,\n        pending: true,\n      };\n    }\n\n    case AuthApiActionTypes.LoginSuccess: {\n      return {\n        ...state,\n        error: null,\n        pending: false,\n      };\n    }\n\n    case AuthApiActionTypes.LoginFailure: {\n      return {\n        ...state,\n        error: action.payload.error,\n        pending: false,\n      };\n    }\n\n    default: {\n      return state;\n    }\n  }\n}\n\nexport const getError = (state: State) => state.error;\nexport const getPending = (state: State) => state.pending;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  createSelector, createFeatureSelector, ActionReducerMap, MemoizedSelector\n} from '@ngrx/store';\n\nimport * as fromRoot from '@gngt/core/reducers';\nimport * as fromAuth from './auth-reducer';\nimport * as fromLoginPage from './login-page-reducer';\nimport {AuthApiActionsUnion} from './auth-api-actions';\nimport {User} from './user';\n\nexport interface AuthState {\n  status: fromAuth.State;\n  loginPage: fromLoginPage.State;\n}\n\nexport interface State extends fromRoot.State {\n  auth: AuthState;\n}\n\nexport const reducers: ActionReducerMap<AuthState, AuthApiActionsUnion> = {\n  status: fromAuth.reducer,\n  loginPage: fromLoginPage.reducer,\n};\n\nexport const selectAuthState: MemoizedSelector<State, AuthState> =\n    createFeatureSelector<State, AuthState>('auth');\n\nexport const selectAuthStatusState: MemoizedSelector<State, fromAuth.State> =\n    createSelector(selectAuthState, (state: AuthState) => state.status);\nexport const getInit: MemoizedSelector<State, boolean> =\n    createSelector(selectAuthStatusState, fromAuth.getInit);\nexport const getUser: MemoizedSelector<State, User | null> =\n  createSelector(selectAuthStatusState, fromAuth.getUser);\nexport const getLoggedIn: MemoizedSelector<State, boolean> =\n    createSelector(getUser, user => user != null);\n\nexport const selectLoginPageState: MemoizedSelector<State, fromLoginPage.State> =\n    createSelector(selectAuthState, (state: AuthState) => state.loginPage);\nexport const getLoginPageError: MemoizedSelector<State, string|null> =\n    createSelector(selectLoginPageState, fromLoginPage.getError);\nexport const getLoginPagePending: MemoizedSelector<State, boolean> =\n    createSelector(selectLoginPageState, fromLoginPage.getPending);\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {InjectionToken} from '@angular/core';\n\nimport {AuthOptions} from './auth-options';\n\n\nexport const AUTH_OPTIONS: InjectionToken<AuthOptions> =\n  new InjectionToken<AuthOptions>('AUTH_OPTIONS', {\n    providedIn: 'root',\n    factory: () => ({\n      loginUrl: '/login',\n      logoutUrl: '/logout',\n      refreshTokenUrl: '/refresh_token',\n      meUrl: '/me'\n    })\n  });\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {InjectionToken} from '@angular/core';\n\nimport {JwtOptions} from './jwt-options';\n\n\nexport const JWT_OPTIONS = new InjectionToken<JwtOptions>('JWT_OPTIONS', {\n  providedIn: 'root',\n  factory: () => ({})\n});\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable, Inject} from '@angular/core';\n\nimport {JwtOptions} from './jwt-options';\nimport {JwtToken} from './jwt-token';\nimport {JWT_OPTIONS} from './jwt-options-token';\n\n\n@Injectable({providedIn: 'root'})\nexport class JwtHelperService {\n  tokenGetter: () => string | null;\n  tokenSetter: (token: string | null) => void;\n  refreshTokenGetter: () => string | null;\n  refreshTokenSetter: (refreshToken: string | null) => void;\n\n  constructor(@Inject(JWT_OPTIONS) config: JwtOptions) {\n    this.tokenGetter = config && config.tokenGetter ?\n      config.tokenGetter : () => null;\n    this.tokenSetter = config && config.tokenSetter ?\n      config.tokenSetter : () => null;\n    this.refreshTokenGetter = config && config.refreshTokenGetter ?\n      config.refreshTokenGetter : () => null;\n    this.refreshTokenSetter = config && config.refreshTokenSetter ?\n      config.refreshTokenSetter : () => null;\n  }\n\n  urlBase64Decode(str: string): string {\n    let output = str.replace(/-/g, '+').replace(/_/g, '/');\n    switch (output.length % 4) {\n      case 0: {\n        break;\n      }\n      case 2: {\n        output += '==';\n        break;\n      }\n      case 3: {\n        output += '=';\n        break;\n      }\n      default: {\n        throw new Error('Illegal base64url string!');\n      }\n    }\n    return this._b64DecodeUnicode(output);\n  }\n\n  // credits for decoder goes to https://github.com/atk\n  private _b64decode(str: string): string {\n    const chars =\n      'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    let output = '';\n\n    str = String(str).replace(/=+$/, '');\n\n    if (str.length % 4 === 1) {\n      throw new Error(\n        '\\'atob\\' failed: The string to be decoded is not correctly encoded.'\n      );\n    }\n\n    for (\n       // tslint:disable:no-bitwise\n      // initialize result and counters\n      let bc = 0, bs: any, buffer: any, idx = 0;\n      // get next character\n      (buffer = str.charAt(idx++));\n      // character found in table? initialize bit storage and add its ascii value;\n      ~buffer &&\n      (\n        (bs = bc % 4 ? bs * 64 + buffer : buffer),\n        // and if not first of each 4 characters,\n        // convert the first 8 bits to one ascii character\n        bc++ % 4\n      )\n        ? (output += String.fromCharCode(255 & (bs >> ((-2 * bc) & 6))))\n        : 0\n    ) {\n      // try to find character in table (0-63, not found => -1)\n      buffer = chars.indexOf(buffer);\n       // tslint:enable:no-bitwise\n    }\n    return output;\n  }\n\n  private _b64DecodeUnicode(str: any) {\n    return decodeURIComponent(\n      Array.prototype.map\n        .call(this._b64decode(str), (c: any) => {\n          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        })\n        .join('')\n    );\n  }\n\n  decodeToken(token: string | null = this.tokenGetter()): JwtToken | null {\n    if (token === null) {\n      return null;\n    }\n\n    const parts = token.split('.');\n\n    if (parts.length !== 3) {\n      throw new Error(\n        'The inspected token doesn\\'t appear to be a JWT. '\n        + 'Check to make sure it has three parts and see https://jwt.io for more.'\n      );\n    }\n\n    const decoded = this.urlBase64Decode(parts[1]);\n    if (!decoded) {\n      throw new Error('Cannot decode the token.');\n    }\n\n    return JSON.parse(decoded);\n  }\n\n  getTokenExpirationDate(token: string | null = this.tokenGetter()): Date | null {\n    let decoded: any;\n    decoded = this.decodeToken(token);\n\n    if (!decoded.hasOwnProperty('exp')) {\n      return null;\n    }\n\n    const date = new Date(0);\n    date.setUTCSeconds(decoded.exp);\n\n    return date;\n  }\n\n  isTokenExpired(token: string | null = this.tokenGetter(), offsetSeconds?: number): boolean {\n    if (token === null || token === '') {\n        return true;\n    }\n    const date = this.getTokenExpirationDate(token);\n    offsetSeconds = offsetSeconds || 0;\n\n    if (date === null) {\n      return true;\n    }\n\n    return !(date.valueOf() > new Date().valueOf() + offsetSeconds * 1000);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable, Inject} from '@angular/core';\nimport {HttpRequest, HttpHandler, HttpEvent, HttpInterceptor} from '@angular/common/http';\n\nimport {Observable} from 'rxjs';\n\nimport * as URLParse from 'url-parse';\n\nimport {JwtHelperService} from './jwt-helper';\nimport {JwtOptions} from './jwt-options';\nimport {JWT_OPTIONS} from './jwt-options-token';\n\n\n@Injectable({providedIn: 'root'})\nexport class JwtInterceptor implements HttpInterceptor {\n  tokenGetter: (() => string | null) | undefined;\n  headerName: string;\n  authScheme: string;\n  whitelistedDomains: Array<string | RegExp>;\n  blacklistedRoutes: Array<string | RegExp>;\n  throwNoTokenError: boolean;\n  skipWhenExpired: boolean;\n\n  constructor(\n    @Inject(JWT_OPTIONS) config: JwtOptions,\n    public jwtHelper: JwtHelperService\n  ) {\n    this.tokenGetter = config.tokenGetter;\n    this.headerName = config.headerName || 'Authorization';\n    this.authScheme =\n      config.authScheme || config.authScheme === ''\n        ? config.authScheme\n        : 'Bearer ';\n    this.whitelistedDomains = config.whitelistedDomains || [];\n    this.blacklistedRoutes = config.blacklistedRoutes || [];\n    this.throwNoTokenError = config.throwNoTokenError || false;\n    this.skipWhenExpired = config.skipWhenExpired || false;\n  }\n\n  isWhitelistedDomain(request: HttpRequest<any>): boolean {\n    const requestUrl = new URLParse(request.url);\n\n    return (\n      requestUrl.host === null ||\n      this.whitelistedDomains.findIndex(\n        domain =>\n          typeof domain === 'string'\n            ? domain === requestUrl.host\n            : domain instanceof RegExp\n              ? domain.test(requestUrl.host)\n              : false\n      ) > -1\n    );\n  }\n\n  isBlacklistedRoute(request: HttpRequest<any>): boolean {\n    const url = request.url;\n\n    return (\n      this.blacklistedRoutes.findIndex(\n        route =>\n          typeof route === 'string'\n            ? route === url\n            : route instanceof RegExp\n              ? route.test(url)\n              : false\n      ) > -1\n    );\n  }\n\n  handleInterception(\n    token: string | null,\n    request: HttpRequest<any>,\n    next: HttpHandler\n  ) {\n    let tokenIsExpired = false;\n\n    if (!token && this.throwNoTokenError) {\n      throw new Error('Could not get token from tokenGetter function.');\n    }\n\n    if (this.skipWhenExpired) {\n      tokenIsExpired = token ? this.jwtHelper.isTokenExpired(token) : true;\n    }\n\n    if (token && tokenIsExpired && this.skipWhenExpired) {\n      request = request.clone();\n    } else if (\n      token &&\n      this.isWhitelistedDomain(request) &&\n      !this.isBlacklistedRoute(request)\n    ) {\n      request = request.clone({\n        setHeaders: {\n          [this.headerName]: `${this.authScheme}${token}`\n        }\n      });\n    }\n    return next.handle(request);\n  }\n\n  intercept(\n    request: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const token = this.tokenGetter ? this.tokenGetter() : null;\n\n    return this.handleInterception(token, request, next);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {HttpClient} from '@angular/common/http';\nimport {Inject, Injectable} from '@angular/core';\n\nimport {Observable} from 'rxjs';\n\nimport {AuthOptions} from './auth-options';\nimport {AUTH_OPTIONS} from './auth-options-token';\nimport {Credentials} from './credentials';\nimport {LoginResponse} from './login-response';\nimport {RefreshTokenResponse} from './refresh-token-response';\nimport {User} from './user';\n\n\n@Injectable({providedIn: 'root'})\nexport class AuthService {\n  constructor(private _http: HttpClient, @Inject(AUTH_OPTIONS) private _config: AuthOptions) {}\n\n  login(credentials: Credentials): Observable<LoginResponse> {\n    const url = this._config.loginUrl;\n    return this._http.post<LoginResponse>(url, credentials);\n  }\n\n  logout() {\n    const url = this._config.logoutUrl;\n    return this._http.post<null>(url, {});\n  }\n\n  refreshToken(refreshToken: string): Observable<RefreshTokenResponse> {\n    const url = this._config.refreshTokenUrl;\n    return this._http.post<RefreshTokenResponse>(url, {refresh_token: refreshToken});\n  }\n\n  getCurrentUser(): Observable<User> {\n    const url = this._config.meUrl;\n    return this._http.get<User>(url);\n  }\n\n  getLoggedInUser(): number | null {\n    return this._config.loggedInUserGetter\n      ? this._config.loggedInUserGetter()\n      : null;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable} from '@angular/core';\nimport {\n  ActivatedRouteSnapshot, CanActivate, CanActivateChild, RouterStateSnapshot\n} from '@angular/router';\n\nimport {Store, select} from '@ngrx/store';\n\nimport {Observable} from 'rxjs';\nimport {concatMap, filter, map, take} from 'rxjs/operators';\n\nimport * as AuthApiActions from './auth-api-actions';\nimport * as fromAuth from './reducers';\n\n@Injectable({providedIn: 'root'})\nexport class AuthGuard implements CanActivate, CanActivateChild {\n  constructor(private _store: Store<fromAuth.State>) {}\n\n  canActivate(): Observable<boolean> {\n    return this._guard();\n  }\n\n  canActivateChild(_cr: ActivatedRouteSnapshot, _state: RouterStateSnapshot): Observable<boolean> {\n    return this._guard();\n  }\n\n  private _guard(): Observable<boolean> {\n    return this._store.pipe(\n      select(fromAuth.getInit),\n      filter(init => init),\n      concatMap(() => this._store.pipe(select(fromAuth.getLoggedIn))),\n      map(authed => {\n        if (!authed) {\n          this._store.dispatch(new AuthApiActions.LoginRedirect());\n          return false;\n        }\n\n        return true;\n      }),\n      take(1)\n    );\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Observable} from 'rxjs';\n\nexport abstract class AuthUserInteractionsService {\n  abstract showLoginError(error: string): void;\n  abstract askLogoutConfirm(): Observable<boolean>;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ChangeDetectorRef, EventEmitter, OnDestroy} from '@angular/core';\nimport {FormBuilder, FormGroup, Validators} from '@angular/forms';\n\nimport {Observable, Subscription} from 'rxjs';\nimport {map} from 'rxjs/operators';\n\nimport {Store} from '@ngrx/store';\n\nimport {forceBooleanProp} from '@gngt/core/common';\n\nimport * as LoginPageActions from './login-page-actions';\nimport * as fromAuth from './reducers';\n\nexport abstract class LoginComponent implements OnDestroy {\n  readonly loginForm: FormGroup;\n  readonly valid: Observable<boolean>;\n\n  private _disabled: boolean;\n  get disabled(): boolean { return this._disabled; }\n  set disabled(disabled: boolean) {\n    this._disabled = forceBooleanProp(disabled);\n    this._cdr.markForCheck();\n  }\n\n  private _loginEvt: EventEmitter<void> = new EventEmitter<void>();\n  private _loginSub: Subscription = Subscription.EMPTY;\n\n  constructor(fb: FormBuilder, store: Store<fromAuth.State>, private _cdr: ChangeDetectorRef) {\n    this.loginForm = fb.group({\n      username: [null, [Validators.required]],\n      password: [null, [Validators.required]]\n    });\n\n    this.valid = this.loginForm.valueChanges.pipe(\n      map(() => this.loginForm.valid)\n    );\n\n    this._loginSub = this._loginEvt.subscribe(() => {\n      store.dispatch(new LoginPageActions.Login({ credentials: this.loginForm.value }));\n    });\n  }\n\n  login(): void {\n    this._loginEvt.next();\n  }\n\n  ngOnDestroy(): void {\n    this._loginSub.unsubscribe();\n    this._loginEvt.complete();\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {HttpErrorResponse} from '@angular/common/http';\nimport {Inject, Injectable} from '@angular/core';\nimport {Router} from '@angular/router';\n\nimport {Observable, of as obsOf, timer, zip} from 'rxjs';\nimport {catchError, delayWhen, exhaustMap, map, mergeMap, switchMap, tap} from 'rxjs/operators';\n\nimport {Actions, createEffect, ofType, OnInitEffects} from '@ngrx/effects';\n\nimport {TranslateService} from '@ngx-translate/core';\n\nimport {AuthService} from './auth';\nimport * as AuthActions from './auth-actions';\nimport * as AuthApiActions from './auth-api-actions';\nimport {AuthOptions} from './auth-options';\nimport {AUTH_OPTIONS} from './auth-options-token';\nimport {AuthUserInteractionsService} from './auth-user-interactions';\nimport {JwtHelperService} from './jwt-helper';\nimport * as LoginPageActions from './login-page-actions';\nimport {Credentials} from './credentials';\n\n\n@Injectable()\nexport class AuthEffects implements OnInitEffects {\n  initUser$ = createEffect(() => this._actions$.pipe(\n    ofType<AuthActions.InitUser>(AuthActions.AuthActionTypes.InitUser),\n    exhaustMap(() =>\n      this._authService.getCurrentUser().pipe(catchError(_ => {\n        return obsOf(this._config.meGetter != null ? this._config.meGetter() : null);\n      }))\n    ),\n    map((user) => {\n      if (this._config.meSetter != null) {\n        this._config.meSetter(user);\n      }\n      return new AuthActions.InitUserComplete({user});\n    })\n  ));\n\n  initUserComplete$ = createEffect(() => this._actions$.pipe(\n    ofType<AuthActions.InitUserComplete>(AuthActions.AuthActionTypes.InitUserComplete),\n    map(() => new AuthActions.InitComplete())\n  ));\n\n  login$ = createEffect(() => this._actions$.pipe(\n    ofType<LoginPageActions.Login>(LoginPageActions.LoginPageActionTypes.Login),\n    map(action => action.payload.credentials),\n    exhaustMap((auth: Credentials) =>\n      this._authService.login(auth).pipe(\n        map((res) => new AuthApiActions.LoginSuccess(res)),\n        catchError((err: HttpErrorResponse) => {\n          const errors: string[] = [];\n          if (err.status === 0 || !err.error.message) {\n            errors.push('Connection problem. Please try again');\n          } else {\n            errors.push(err.error.message);\n          }\n          return zip(...errors.map(e => <Observable<string>>this._ts.get(e)))\n            .pipe(\n              map(error => new AuthApiActions.LoginFailure({error}))\n            );\n        })\n      )\n    )\n  ));\n\n  loginSuccess$ = createEffect(() => this._actions$.pipe(\n    ofType<AuthApiActions.LoginSuccess>(AuthApiActions.AuthApiActionTypes.LoginSuccess),\n    tap((action) => {\n      const payload = <any>action.payload;\n      const tokenKey = this._config.tokenKey || 'access_token';\n      const refreshTokenKey = this._config.refreshTokenKey || 'refresh_token';\n      this._jwtHelperService.tokenSetter(payload[tokenKey]);\n      this._jwtHelperService.refreshTokenSetter(payload[refreshTokenKey]);\n      if (this._config.loggedInUserSetter) {\n        this._config.loggedInUserSetter(payload.user_id);\n      }\n      this._router.navigate(['/']);\n    }),\n    mergeMap((action) => [\n      this._getRefreshTokenAction(),\n      new AuthActions.InitUserComplete({user: action.payload.user}),\n    ]),\n  ));\n\n  loginFailure$ = createEffect(() => this._actions$.pipe(\n    ofType<AuthApiActions.LoginFailure>(AuthApiActions.AuthApiActionTypes.LoginFailure),\n    tap((action) => {\n      this._userInteractionsService.showLoginError(action.payload.error.join('\\n'));\n    }),\n  ), {dispatch: false});\n\n  refreshToken$ = createEffect(() => this._actions$.pipe(\n    ofType<AuthApiActions.RefreshToken>(AuthApiActions.AuthApiActionTypes.RefreshToken),\n    delayWhen((action: AuthApiActions.RefreshToken) => timer(action.payload.refreshDelay)),\n    exhaustMap((action: AuthApiActions.RefreshToken) =>\n      this._authService.refreshToken(this._jwtHelperService.refreshTokenGetter() || '').pipe(\n        switchMap((payload: any) => {\n          const res: (AuthApiActions.AuthApiActionsUnion | AuthActions.AuthActionsUnion)[] = [];\n          const tokenKey = this._config.tokenKey || 'access_token';\n          this._jwtHelperService.tokenSetter(payload[tokenKey]);\n          if (action.payload.fromInit) {\n            res.push(new AuthActions.InitUser());\n          }\n          res.push(this._getRefreshTokenAction());\n          return res;\n        }),\n        catchError(() => obsOf(new AuthActions.InitComplete()))\n      )\n    )\n  ));\n\n  loginRedirect$ = createEffect(() => this._actions$.pipe(\n    ofType(\n      AuthApiActions.AuthApiActionTypes.LoginRedirect,\n      AuthActions.AuthActionTypes.Logout\n    ),\n    tap(_authed => {\n      this._router.navigate(['/login']);\n    })\n  ), {dispatch: false});\n\n  logoutConfirmation$ = createEffect(() => this._actions$.pipe(\n    ofType(AuthActions.AuthActionTypes.LogoutConfirmation),\n    exhaustMap(() => this._userInteractionsService.askLogoutConfirm()),\n    map(\n      result =>\n        result\n          ? new AuthActions.Logout()\n          : new AuthActions.LogoutConfirmationDismiss()\n    )\n  ));\n\n  init$ = createEffect(() => this._actions$.pipe(\n    ofType(AuthActions.AuthActionTypes.Init),\n    switchMap(() => {\n      const res: (AuthApiActions.AuthApiActionsUnion | AuthActions.AuthActionsUnion)[] = [];\n      const token = this._jwtHelperService.tokenGetter();\n      if (token) {\n        try {\n          if (!this._jwtHelperService.isTokenExpired(token)) {\n            const decoded = this._jwtHelperService.decodeToken(token);\n            const scopes = this._config.disableScopes ? [] : this._getScopesFromToken(decoded);\n            if (this._config.disableScopes || scopes.indexOf('admin') > -1) {\n              res.push(new AuthActions.InitUser());\n              res.push(this._getRefreshTokenAction());\n            }\n          } else {\n            res.push(new AuthApiActions.RefreshToken({refreshDelay: 0, fromInit: true}));\n          }\n        } catch (e) {\n          res.push(new AuthActions.InitComplete());\n        }\n      } else {\n        res.push(new AuthActions.InitComplete());\n      }\n      return res;\n    })\n  ));\n\n  constructor(\n    private _actions$: Actions,\n    private _authService: AuthService,\n    private _jwtHelperService: JwtHelperService,\n    private _userInteractionsService: AuthUserInteractionsService,\n    private _router: Router,\n    private _ts: TranslateService,\n    @Inject(AUTH_OPTIONS) private _config: AuthOptions\n  ) {}\n\n  ngrxOnInitEffects(): AuthActions.Init {\n    return new AuthActions.Init();\n  }\n\n  private _getRefreshTokenAction(fromInit?: boolean): AuthApiActions.RefreshToken {\n    const accessToken = this._jwtHelperService.tokenGetter();\n    const exp = this._jwtHelperService.getTokenExpirationDate(accessToken) || new Date();\n    const refreshDelay = Math.max(0, Math.round((exp.getTime() - new Date().getTime()) * 0.8));\n    return new AuthApiActions.RefreshToken({refreshDelay, fromInit});\n  }\n\n  private _getScopesFromToken(token: any): string[] {\n    const scopesPath = this._config.scopesPath || ['scopes'];\n    scopesPath.forEach(p => token = token[p]);\n    return token;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\n\nimport {EffectsModule} from '@ngrx/effects';\nimport {StoreModule} from '@ngrx/store';\n\nimport {AuthService} from './auth';\nimport {AuthEffects} from './auth-effects';\nimport {AuthGuard} from './auth-guard';\nimport {JwtHelperService} from './jwt-helper';\nimport {JwtInterceptor} from './jwt-interceptor';\nimport {reducers} from './reducers';\n\n@NgModule({\n  imports: [\n    StoreModule.forFeature('auth', reducers),\n    EffectsModule.forFeature([AuthEffects]),\n  ],\n  providers: [\n    AuthEffects,\n    AuthGuard,\n    AuthService,\n    JwtHelperService,\n    JwtInterceptor\n  ]\n})\nexport class AuthModule { }\n"],"names":["LogoutConfirmation","this","type","AuthActionTypes","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","Init","InitUser","InitUserComplete","InitComplete","Logout","LogoutConfirmationDismiss","payload","LoginSuccess","LoginFailure","LoginRedirect","RefreshToken","AuthApiActionTypes","initialState","init","user","token","reducer","state","action","tslib_1.__assign","AuthActions.AuthActionTypes","Login","LoginPageActionTypes","error","pending","status","loginPage","reducers","fromAuth.reducer","fromLoginPage.reducer","selectAuthState","createFeatureSelector","selectAuthStatusState","createSelector","getInit","getUser","getLoggedIn","selectLoginPageState","getLoginPageError","getLoginPagePending","AUTH_OPTIONS","InjectionToken","providedIn","factory","loginUrl","logoutUrl","refreshTokenUrl","meUrl","JWT_OPTIONS","JwtHelperService","urlBase64Decode","str","output","replace","Error","_b64DecodeUnicode","_b64decode","String","bc","bs","buffer","idx","charAt","fromCharCode","indexOf","decodeURIComponent","Array","map","c","charCodeAt","toString","slice","join","decodeToken","tokenGetter","parts","split","decoded","JSON","parse","getTokenExpirationDate","date","Date","setUTCSeconds","exp","isTokenExpired","offsetSeconds","valueOf","Injectable","args","undefined","decorators","Inject","config","tokenSetter","refreshTokenGetter","refreshTokenSetter","JwtInterceptor","isWhitelistedDomain","request","requestUrl","URLParse","url","host","whitelistedDomains","findIndex","domain","RegExp","test","isBlacklistedRoute","blacklistedRoutes","route","handleInterception","next","tokenIsExpired","throwNoTokenError","skipWhenExpired","jwtHelper","clone","setHeaders","_a","headerName","authScheme","handle","intercept","AuthService","login","credentials","_config","_http","post","logout","refreshToken","refresh_token","getCurrentUser","get","getLoggedInUser","loggedInUserGetter","HttpClient","AuthGuard","canActivate","_guard","canActivateChild","_cr","_state","_this","_store","pipe","select","fromAuth.getInit","filter","concatMap","fromAuth.getLoggedIn","authed","dispatch","AuthApiActions.LoginRedirect","take","Store","defineProperty","LoginComponent","_disabled","disabled","forceBooleanProp","_cdr","markForCheck","_loginEvt","ngOnDestroy","_loginSub","unsubscribe","complete","fb","store","EventEmitter","Subscription","EMPTY","loginForm","group","username","Validators","required","password","valid","valueChanges","subscribe","LoginPageActions.Login","value","AuthEffects","ngrxOnInitEffects","AuthActions.Init","_getRefreshTokenAction","fromInit","accessToken","_jwtHelperService","refreshDelay","Math","max","round","getTime","AuthApiActions.RefreshToken","_getScopesFromToken","scopesPath","forEach","Actions","AuthUserInteractionsService","Router","TranslateService","_actions$","_authService","_userInteractionsService","_router","_ts","initUser$","createEffect","ofType","exhaustMap","catchError","_","obsOf","of","meGetter","meSetter","AuthActions.InitUserComplete","initUserComplete$","AuthActions.InitComplete","login$","LoginPageActions.LoginPageActionTypes","auth","res","AuthApiActions.LoginSuccess","err","errors","message","push","zip","e","AuthApiActions.LoginFailure","loginSuccess$","AuthApiActions.AuthApiActionTypes","tap","tokenKey","refreshTokenKey","loggedInUserSetter","user_id","navigate","mergeMap","loginFailure$","showLoginError","refreshToken$","delayWhen","timer","switchMap","AuthActions.InitUser","loginRedirect$","_authed","logoutConfirmation$","askLogoutConfirm","result","AuthActions.Logout","AuthActions.LogoutConfirmationDismiss","init$","scopes","disableScopes","AuthModule","NgModule","imports","StoreModule","forFeature","EffectsModule","providers"],"mappings":"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"}