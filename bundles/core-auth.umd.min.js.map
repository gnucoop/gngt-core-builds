{"version":3,"file":"core-auth.umd.min.js","sources":["../../node_modules/tslib/tslib.es6.js","../../src/core/auth/auth-api-actions.ts","../../src/core/auth/auth-actions.ts","../../src/core/auth/auth-reducer.ts","../../src/core/auth/login-page-actions.ts","../../src/core/auth/login-page-reducer.ts","../../src/core/auth/reducers.ts","../../src/core/auth/auth-options-token.ts","../../src/core/auth/jwt-options-token.ts","../../src/core/auth/jwt-helper.ts","../../src/core/auth/jwt-interceptor.ts","../../src/core/auth/auth.ts","../../src/core/auth/auth-guard.ts","../../src/core/auth/auth-user-interactions.ts","../../src/core/auth/login.ts","../../src/core/auth/auth-effects.ts","../../src/core/auth/auth-module.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\nimport {LoginResponse} from './login-response';\n\nexport enum AuthApiActionTypes {\n  LoginSuccess = '[Auth/API] Login Success',\n  LoginFailure = '[Auth/API] Login Failure',\n  LoginRedirect = '[Auth/API] Login Redirect',\n  RefreshToken= '[Auth/API] Refresh token'\n}\n\nexport class LoginSuccess implements Action {\n  readonly type = AuthApiActionTypes.LoginSuccess;\n\n  constructor(public payload: LoginResponse) {}\n}\n\nexport class LoginFailure implements Action {\n  readonly type = AuthApiActionTypes.LoginFailure;\n\n  constructor(public payload: { error: any }) {}\n}\n\nexport class LoginRedirect implements Action {\n  readonly type = AuthApiActionTypes.LoginRedirect;\n}\n\nexport class RefreshToken implements Action {\n  readonly type = AuthApiActionTypes.RefreshToken;\n\n  constructor(public payload: { refreshDelay: number, fromInit?: boolean }) {}\n}\n\nexport type AuthApiActionsUnion =\n  | LoginSuccess\n  | LoginFailure\n  | LoginRedirect\n  | RefreshToken;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\n\nimport {User} from './user';\n\n\nexport enum AuthActionTypes {\n  InitUser = '[Auth] Init user',\n  InitUserComplete = '[Auth] Init user complete',\n  InitComplete = '[Auth] Init complete',\n  Logout = '[Auth] Logout',\n  LogoutConfirmation = '[Auth] Logout Confirmation',\n  LogoutConfirmationDismiss = '[Auth] Logout Confirmation Dismiss',\n}\n\nexport class InitUser implements Action {\n  readonly type = AuthActionTypes.InitUser;\n}\n\nexport class InitUserComplete implements Action {\n  readonly type = AuthActionTypes.InitUserComplete;\n\n  constructor(public payload: { user: User | null }) {}\n}\n\nexport class InitComplete implements Action {\n  readonly type = AuthActionTypes.InitComplete;\n}\n\nexport class Logout implements Action {\n  readonly type = AuthActionTypes.Logout;\n}\n\nexport class LogoutConfirmation implements Action {\n  readonly type = AuthActionTypes.LogoutConfirmation;\n}\n\nexport class LogoutConfirmationDismiss implements Action {\n  readonly type = AuthActionTypes.LogoutConfirmationDismiss;\n}\n\nexport type AuthActionsUnion =\n  | InitUser\n  | InitUserComplete\n  | InitComplete\n  | Logout\n  | LogoutConfirmation\n  | LogoutConfirmationDismiss;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AuthApiActionsUnion, AuthApiActionTypes} from './auth-api-actions';\nimport * as AuthActions from './auth-actions';\nimport {User} from './user';\n\nexport interface State {\n  init: boolean;\n  user: User | null;\n  token: string | null;\n}\n\nexport const initialState: State = {\n  init: false,\n  user: null,\n  token: null\n};\n\nexport function reducer(\n  state = initialState,\n  action: AuthApiActionsUnion | AuthActions.AuthActionsUnion\n): State {\n  switch (action.type) {\n    case AuthApiActionTypes.LoginSuccess: {\n      return {\n        ...state,\n        user: action.payload.user,\n      };\n    }\n\n    case AuthActions.AuthActionTypes.Logout: {\n      return initialState;\n    }\n\n    case AuthActions.AuthActionTypes.InitUserComplete: {\n      return {\n        ...state,\n        init: true,\n        user: action.payload.user\n      };\n    }\n\n    case AuthActions.AuthActionTypes.InitComplete: {\n      return {\n        ...state,\n        init: true\n      };\n    }\n\n    default: {\n      return state;\n    }\n  }\n}\n\nexport const getInit = (state: State) => state.init;\nexport const getUser = (state: State) => state.user;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\nimport {Credentials} from './credentials';\n\nexport enum LoginPageActionTypes {\n  Login = '[Login Page] Login',\n}\n\nexport class Login implements Action {\n  readonly type = LoginPageActionTypes.Login;\n\n  constructor(public payload: { credentials: Credentials }) {}\n}\n\nexport type LoginPageActionsUnion = Login;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AuthApiActionTypes, AuthApiActionsUnion} from './auth-api-actions';\nimport {LoginPageActionTypes, LoginPageActionsUnion} from './login-page-actions';\n\nexport interface State {\n  error: string | null;\n  pending: boolean;\n}\n\nexport const initialState: State = {\n  error: null,\n  pending: false,\n};\n\nexport function reducer(\n  state = initialState,\n  action: AuthApiActionsUnion | LoginPageActionsUnion\n): State {\n  switch (action.type) {\n    case LoginPageActionTypes.Login: {\n      return {\n        ...state,\n        error: null,\n        pending: true,\n      };\n    }\n\n    case AuthApiActionTypes.LoginSuccess: {\n      return {\n        ...state,\n        error: null,\n        pending: false,\n      };\n    }\n\n    case AuthApiActionTypes.LoginFailure: {\n      return {\n        ...state,\n        error: action.payload.error,\n        pending: false,\n      };\n    }\n\n    default: {\n      return state;\n    }\n  }\n}\n\nexport const getError = (state: State) => state.error;\nexport const getPending = (state: State) => state.pending;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  createSelector, createFeatureSelector, ActionReducerMap, MemoizedSelector\n} from '@ngrx/store';\n\nimport * as fromRoot from '@gngt/core/reducers';\nimport * as fromAuth from './auth-reducer';\nimport * as fromLoginPage from './login-page-reducer';\nimport {AuthApiActionsUnion} from './auth-api-actions';\nimport {User} from './user';\n\nexport interface AuthState {\n  status: fromAuth.State;\n  loginPage: fromLoginPage.State;\n}\n\nexport interface State extends fromRoot.State {\n  auth: AuthState;\n}\n\nexport const reducers: ActionReducerMap<AuthState, AuthApiActionsUnion> = {\n  status: fromAuth.reducer,\n  loginPage: fromLoginPage.reducer,\n};\n\nexport const selectAuthState = createFeatureSelector<State, AuthState>('auth');\n\nexport const selectAuthStatusState = createSelector(\n  selectAuthState,\n  (state: AuthState) => state.status\n);\nexport const getInit = createSelector(selectAuthStatusState, fromAuth.getInit);\nexport const getUser: MemoizedSelector<State, User | null> =\n  createSelector(selectAuthStatusState, fromAuth.getUser);\nexport const getLoggedIn = createSelector(getUser, user => user != null);\n\nexport const selectLoginPageState = createSelector(\n  selectAuthState,\n  (state: AuthState) => state.loginPage\n);\nexport const getLoginPageError = createSelector(\n  selectLoginPageState,\n  fromLoginPage.getError\n);\nexport const getLoginPagePending = createSelector(\n  selectLoginPageState,\n  fromLoginPage.getPending\n);\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {InjectionToken} from '@angular/core';\n\nimport {AuthOptions} from './auth-options';\n\n\nexport const AUTH_OPTIONS: InjectionToken<AuthOptions> =\n  new InjectionToken<AuthOptions>('AUTH_OPTIONS', {\n    providedIn: 'root',\n    factory: () => ({\n      loginUrl: '/login',\n      logoutUrl: '/logout',\n      refreshTokenUrl: '/refresh_token',\n      meUrl: '/me'\n    })\n  });\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {InjectionToken} from '@angular/core';\n\nimport {JwtOptions} from './jwt-options';\n\n\nexport const JWT_OPTIONS = new InjectionToken<JwtOptions>('JWT_OPTIONS', {\n  providedIn: 'root',\n  factory: () => ({})\n});\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable, Inject} from '@angular/core';\n\nimport {JwtOptions} from './jwt-options';\nimport {JwtToken} from './jwt-token';\nimport {JWT_OPTIONS} from './jwt-options-token';\n\n\n@Injectable({providedIn: 'root'})\nexport class JwtHelperService {\n  tokenGetter: () => string | null;\n  tokenSetter: (token: string | null) => void;\n  refreshTokenGetter: () => string | null;\n  refreshTokenSetter: (refreshToken: string | null) => void;\n\n  constructor(@Inject(JWT_OPTIONS) config: JwtOptions) {\n    this.tokenGetter = config && config.tokenGetter ?\n      config.tokenGetter : () => null;\n    this.tokenSetter = config && config.tokenSetter ?\n      config.tokenSetter : () => null;\n    this.refreshTokenGetter = config && config.refreshTokenGetter ?\n      config.refreshTokenGetter : () => null;\n    this.refreshTokenSetter = config && config.refreshTokenSetter ?\n      config.refreshTokenSetter : () => null;\n  }\n\n  urlBase64Decode(str: string): string {\n    let output = str.replace(/-/g, '+').replace(/_/g, '/');\n    switch (output.length % 4) {\n      case 0: {\n        break;\n      }\n      case 2: {\n        output += '==';\n        break;\n      }\n      case 3: {\n        output += '=';\n        break;\n      }\n      default: {\n        throw new Error('Illegal base64url string!');\n      }\n    }\n    return this.b64DecodeUnicode(output);\n  }\n\n  // credits for decoder goes to https://github.com/atk\n  private b64decode(str: string): string {\n    const chars =\n      'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    let output = '';\n\n    str = String(str).replace(/=+$/, '');\n\n    if (str.length % 4 === 1) {\n      throw new Error(\n        '\\'atob\\' failed: The string to be decoded is not correctly encoded.'\n      );\n    }\n\n    for (\n       // tslint:disable:no-bitwise\n      // initialize result and counters\n      let bc = 0, bs: any, buffer: any, idx = 0;\n      // get next character\n      (buffer = str.charAt(idx++));\n      // character found in table? initialize bit storage and add its ascii value;\n      ~buffer &&\n      (\n        (bs = bc % 4 ? bs * 64 + buffer : buffer),\n        // and if not first of each 4 characters,\n        // convert the first 8 bits to one ascii character\n        bc++ % 4\n      )\n        ? (output += String.fromCharCode(255 & (bs >> ((-2 * bc) & 6))))\n        : 0\n    ) {\n      // try to find character in table (0-63, not found => -1)\n      buffer = chars.indexOf(buffer);\n       // tslint:enable:no-bitwise\n    }\n    return output;\n  }\n\n  private b64DecodeUnicode(str: any) {\n    return decodeURIComponent(\n      Array.prototype.map\n        .call(this.b64decode(str), (c: any) => {\n          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        })\n        .join('')\n    );\n  }\n\n  decodeToken(token: string | null = this.tokenGetter()): JwtToken | null {\n    if (token === null) {\n      return null;\n    }\n\n    const parts = token.split('.');\n\n    if (parts.length !== 3) {\n      throw new Error(\n        'The inspected token doesn\\'t appear to be a JWT. '\n        + 'Check to make sure it has three parts and see https://jwt.io for more.'\n      );\n    }\n\n    const decoded = this.urlBase64Decode(parts[1]);\n    if (!decoded) {\n      throw new Error('Cannot decode the token.');\n    }\n\n    return JSON.parse(decoded);\n  }\n\n  getTokenExpirationDate(token: string | null = this.tokenGetter()): Date | null {\n    let decoded: any;\n    decoded = this.decodeToken(token);\n\n    if (!decoded.hasOwnProperty('exp')) {\n      return null;\n    }\n\n    const date = new Date(0);\n    date.setUTCSeconds(decoded.exp);\n\n    return date;\n  }\n\n  isTokenExpired(token: string | null = this.tokenGetter(), offsetSeconds?: number): boolean {\n    if (token === null || token === '') {\n        return true;\n    }\n    const date = this.getTokenExpirationDate(token);\n    offsetSeconds = offsetSeconds || 0;\n\n    if (date === null) {\n      return true;\n    }\n\n    return !(date.valueOf() > new Date().valueOf() + offsetSeconds * 1000);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable, Inject} from '@angular/core';\nimport {HttpRequest, HttpHandler, HttpEvent, HttpInterceptor} from '@angular/common/http';\n\nimport {Observable} from 'rxjs';\n\nimport * as URLParse from 'url-parse';\n\nimport {JwtHelperService} from './jwt-helper';\nimport {JwtOptions} from './jwt-options';\nimport {JWT_OPTIONS} from './jwt-options-token';\n\n\n@Injectable({providedIn: 'root'})\nexport class JwtInterceptor implements HttpInterceptor {\n  tokenGetter: (() => string | null) | undefined;\n  headerName: string;\n  authScheme: string;\n  whitelistedDomains: Array<string | RegExp>;\n  blacklistedRoutes: Array<string | RegExp>;\n  throwNoTokenError: boolean;\n  skipWhenExpired: boolean;\n\n  constructor(\n    @Inject(JWT_OPTIONS) config: JwtOptions,\n    public jwtHelper: JwtHelperService\n  ) {\n    this.tokenGetter = config.tokenGetter;\n    this.headerName = config.headerName || 'Authorization';\n    this.authScheme =\n      config.authScheme || config.authScheme === ''\n        ? config.authScheme\n        : 'Bearer ';\n    this.whitelistedDomains = config.whitelistedDomains || [];\n    this.blacklistedRoutes = config.blacklistedRoutes || [];\n    this.throwNoTokenError = config.throwNoTokenError || false;\n    this.skipWhenExpired = config.skipWhenExpired || false;\n  }\n\n  isWhitelistedDomain(request: HttpRequest<any>): boolean {\n    const requestUrl = new URLParse(request.url);\n\n    return (\n      requestUrl.host === null ||\n      this.whitelistedDomains.findIndex(\n        domain =>\n          typeof domain === 'string'\n            ? domain === requestUrl.host\n            : domain instanceof RegExp\n              ? domain.test(requestUrl.host)\n              : false\n      ) > -1\n    );\n  }\n\n  isBlacklistedRoute(request: HttpRequest<any>): boolean {\n    const url = request.url;\n\n    return (\n      this.blacklistedRoutes.findIndex(\n        route =>\n          typeof route === 'string'\n            ? route === url\n            : route instanceof RegExp\n              ? route.test(url)\n              : false\n      ) > -1\n    );\n  }\n\n  handleInterception(\n    token: string | null,\n    request: HttpRequest<any>,\n    next: HttpHandler\n  ) {\n    let tokenIsExpired = false;\n\n    if (!token && this.throwNoTokenError) {\n      throw new Error('Could not get token from tokenGetter function.');\n    }\n\n    if (this.skipWhenExpired) {\n      tokenIsExpired = token ? this.jwtHelper.isTokenExpired(token) : true;\n    }\n\n    if (token && tokenIsExpired && this.skipWhenExpired) {\n      request = request.clone();\n    } else if (\n      token &&\n      this.isWhitelistedDomain(request) &&\n      !this.isBlacklistedRoute(request)\n    ) {\n      request = request.clone({\n        setHeaders: {\n          [this.headerName]: `${this.authScheme}${token}`\n        }\n      });\n    }\n    return next.handle(request);\n  }\n\n  intercept(\n    request: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const token = this.tokenGetter ? this.tokenGetter() : null;\n\n    return this.handleInterception(token, request, next);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {HttpClient} from '@angular/common/http';\nimport {Inject, Injectable} from '@angular/core';\n\nimport {Observable} from 'rxjs';\n\nimport {AuthOptions} from './auth-options';\nimport {AUTH_OPTIONS} from './auth-options-token';\nimport {Credentials} from './credentials';\nimport {LoginResponse} from './login-response';\nimport {RefreshTokenResponse} from './refresh-token-response';\nimport {User} from './user';\n\n\n@Injectable({providedIn: 'root'})\nexport class AuthService {\n  constructor(private _http: HttpClient, @Inject(AUTH_OPTIONS) private _config: AuthOptions) {}\n\n  login(credentials: Credentials): Observable<LoginResponse> {\n    const url = this._config.loginUrl;\n    return this._http.post<LoginResponse>(url, credentials);\n  }\n\n  logout() {\n    const url = this._config.logoutUrl;\n    return this._http.post<null>(url, {});\n  }\n\n  refreshToken(refreshToken: string): Observable<RefreshTokenResponse> {\n    const url = this._config.refreshTokenUrl;\n    return this._http.post<RefreshTokenResponse>(url, {refresh_token: refreshToken});\n  }\n\n  getCurrentUser(): Observable<User> {\n    const url = this._config.meUrl;\n    return this._http.get<User>(url);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable} from '@angular/core';\nimport {\n  ActivatedRouteSnapshot, CanActivate, CanActivateChild, RouterStateSnapshot\n} from '@angular/router';\n\nimport {Store, select} from '@ngrx/store';\n\nimport {Observable} from 'rxjs';\nimport {filter, map, switchMap, take} from 'rxjs/operators';\n\nimport * as AuthApiActions from './auth-api-actions';\nimport * as fromAuth from './reducers';\n\n\n@Injectable({providedIn: 'root'})\nexport class AuthGuard implements CanActivate, CanActivateChild {\n  constructor(private store: Store<fromAuth.State>) {}\n\n  canActivate(): Observable<boolean> {\n    return this._guard();\n  }\n\n  canActivateChild(_cr: ActivatedRouteSnapshot, _state: RouterStateSnapshot): Observable<boolean> {\n    return this._guard();\n  }\n\n  private _guard(): Observable<boolean> {\n    return this.store.pipe(\n      select(fromAuth.getInit),\n      filter(init => init),\n      switchMap(() => this.store.pipe(select(fromAuth.getLoggedIn))),\n      map(authed => {\n        if (!authed) {\n          this.store.dispatch(new AuthApiActions.LoginRedirect());\n          return false;\n        }\n\n        return true;\n      }),\n      take(1)\n    );\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Observable} from 'rxjs';\n\nexport abstract class AuthUserInteractionsService {\n  abstract showLoginError(error: string): void;\n  abstract askLogoutConfirm(): Observable<boolean>;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ChangeDetectorRef, EventEmitter, OnDestroy} from '@angular/core';\nimport {FormBuilder, FormGroup, Validators} from '@angular/forms';\n\nimport {Observable, Subscription} from 'rxjs';\nimport {map} from 'rxjs/operators';\n\nimport {Store} from '@ngrx/store';\n\nimport {forceBooleanProp} from '@gngt/core/common';\n\nimport * as LoginPageActions from './login-page-actions';\nimport * as fromAuth from './reducers';\n\nexport abstract class LoginComponent implements OnDestroy {\n  readonly loginForm: FormGroup;\n  readonly valid: Observable<boolean>;\n\n  private _disabled: boolean;\n  get disabled(): boolean { return this._disabled; }\n  set disabled(disabled: boolean) {\n    this._disabled = forceBooleanProp(disabled);\n    this._cdr.markForCheck();\n  }\n\n  private _loginEvt: EventEmitter<void> = new EventEmitter<void>();\n  private _loginSub: Subscription = Subscription.EMPTY;\n\n  constructor(fb: FormBuilder, store: Store<fromAuth.State>, private _cdr: ChangeDetectorRef) {\n    this.loginForm = fb.group({\n      username: [null, [Validators.required]],\n      password: [null, [Validators.required]]\n    });\n\n    this.valid = this.loginForm.valueChanges.pipe(\n      map(() => this.loginForm.valid)\n    );\n\n    this._loginSub = this._loginEvt.subscribe(() => {\n      store.dispatch(new LoginPageActions.Login({ credentials: this.loginForm.value }));\n    });\n  }\n\n  login(): void {\n    this._loginEvt.next();\n  }\n\n  ngOnDestroy(): void {\n    this._loginSub.unsubscribe();\n    this._loginEvt.complete();\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {HttpErrorResponse} from '@angular/common/http';\nimport {Inject, Injectable} from '@angular/core';\nimport {Router} from '@angular/router';\n\nimport {defer, Observable, of as obsOf, timer, zip} from 'rxjs';\nimport {catchError, delayWhen, exhaustMap, map, switchMap, tap} from 'rxjs/operators';\n\nimport {Actions, Effect, ofType} from '@ngrx/effects';\n\nimport {TranslateService} from '@ngx-translate/core';\n\nimport {AuthService} from './auth';\nimport * as AuthActions from './auth-actions';\nimport * as AuthApiActions from './auth-api-actions';\nimport {AuthOptions} from './auth-options';\nimport {AUTH_OPTIONS} from './auth-options-token';\nimport {AuthUserInteractionsService} from './auth-user-interactions';\nimport {JwtHelperService} from './jwt-helper';\nimport * as LoginPageActions from './login-page-actions';\nimport {Credentials} from './credentials';\n\n\n@Injectable()\nexport class AuthEffects {\n  @Effect()\n  initUser$ = this.actions$.pipe(\n    ofType<AuthActions.InitUser>(AuthActions.AuthActionTypes.InitUser),\n    exhaustMap(() =>\n      this.authService.getCurrentUser().pipe(catchError(_ => obsOf(null)))\n    ),\n    map((user) => new AuthActions.InitUserComplete({user}))\n  );\n\n  @Effect()\n  initUserComplete$ = this.actions$.pipe(\n    ofType<AuthActions.InitUserComplete>(AuthActions.AuthActionTypes.InitUserComplete),\n    map(() => new AuthActions.InitComplete())\n  );\n\n  @Effect()\n  login$ = this.actions$.pipe(\n    ofType<LoginPageActions.Login>(LoginPageActions.LoginPageActionTypes.Login),\n    map(action => action.payload.credentials),\n    exhaustMap((auth: Credentials) =>\n      this.authService.login(auth).pipe(\n        map((res) => new AuthApiActions.LoginSuccess(res)),\n        catchError((err: HttpErrorResponse) => {\n          const errors: string[] = [];\n          if (err.status === 0 || !err.error.message) {\n            errors.push('Connection problem. Please try again');\n          } else {\n            errors.push(err.error.message);\n          }\n          return zip(...errors.map(e => <Observable<string>>this.ts.get(e)))\n            .pipe(\n              map(error => new AuthApiActions.LoginFailure({error}))\n            );\n        })\n      )\n    )\n  );\n\n  @Effect()\n  loginSuccess$ = this.actions$.pipe(\n    ofType<AuthApiActions.LoginSuccess>(AuthApiActions.AuthApiActionTypes.LoginSuccess),\n    tap((action) => {\n      const payload = <any>action.payload;\n      const tokenKey = this.config.tokenKey || 'access_token';\n      const refreshTokenKey = this.config.refreshTokenKey || 'refresh_token';\n      this.jwtHelperService.tokenSetter(payload[tokenKey]);\n      this.jwtHelperService.refreshTokenSetter(payload[refreshTokenKey]);\n      this.router.navigate(['/']);\n    }),\n    map(() => {\n      return this._getRefreshTokenAction();\n    })\n  );\n\n  @Effect({dispatch: false})\n  loginFailure$ = this.actions$.pipe(\n    ofType<AuthApiActions.LoginFailure>(AuthApiActions.AuthApiActionTypes.LoginFailure),\n    tap((action) => {\n      this.userInteractionsService.showLoginError(action.payload.error.join('\\n'));\n    })\n  );\n\n  @Effect()\n  refreshToken$ = this.actions$.pipe(\n    ofType<AuthApiActions.RefreshToken>(AuthApiActions.AuthApiActionTypes.RefreshToken),\n    delayWhen((action: AuthApiActions.RefreshToken) => timer(action.payload.refreshDelay)),\n    exhaustMap((action: AuthApiActions.RefreshToken) =>\n      this.authService.refreshToken(this.jwtHelperService.refreshTokenGetter() || '').pipe(\n        switchMap((payload: any) => {\n          const res: (AuthApiActions.AuthApiActionsUnion | AuthActions.AuthActionsUnion)[] = [];\n          const tokenKey = this.config.tokenKey || 'access_token';\n          this.jwtHelperService.tokenSetter(payload[tokenKey]);\n          if (action.payload.fromInit) {\n            res.push(new AuthActions.InitUser());\n          }\n          res.push(this._getRefreshTokenAction());\n          return res;\n        }),\n        catchError(() => obsOf(new AuthActions.InitComplete()))\n      )\n    )\n  );\n\n  @Effect({ dispatch: false })\n  loginRedirect$ = this.actions$.pipe(\n    ofType(\n      AuthApiActions.AuthApiActionTypes.LoginRedirect,\n      AuthActions.AuthActionTypes.Logout\n    ),\n    tap(_authed => {\n      this.router.navigate(['/login']);\n    })\n  );\n\n  @Effect()\n  logoutConfirmation$ = this.actions$.pipe(\n    ofType(AuthActions.AuthActionTypes.LogoutConfirmation),\n    exhaustMap(() => this.userInteractionsService.askLogoutConfirm()),\n    map(\n      result =>\n        result\n          ? new AuthActions.Logout()\n          : new AuthActions.LogoutConfirmationDismiss()\n    )\n  );\n\n  @Effect()\n  init$ = defer(() => obsOf(null)).pipe(\n    switchMap(() => {\n      const res: (AuthApiActions.AuthApiActionsUnion | AuthActions.AuthActionsUnion)[] = [];\n      const token = this.jwtHelperService.tokenGetter();\n      if (token) {\n        try {\n          if (!this.jwtHelperService.isTokenExpired(token)) {\n            const decoded = this.jwtHelperService.decodeToken(token);\n            const scopes = this.config.disableScopes ? [] : this._getScopesFromToken(decoded);\n            if (this.config.disableScopes || scopes.indexOf('admin') > -1) {\n              res.push(new AuthActions.InitUser());\n              res.push(this._getRefreshTokenAction());\n            }\n          } else {\n            res.push(new AuthApiActions.RefreshToken({refreshDelay: 0, fromInit: true}));\n          }\n        } catch (e) {\n          res.push(new AuthActions.InitComplete());\n        }\n      } else {\n        res.push(new AuthActions.InitComplete());\n      }\n      return res;\n    })\n  );\n\n  constructor(\n    private actions$: Actions,\n    private authService: AuthService,\n    private jwtHelperService: JwtHelperService,\n    private userInteractionsService: AuthUserInteractionsService,\n    private router: Router,\n    private ts: TranslateService,\n    @Inject(AUTH_OPTIONS) private config: AuthOptions\n  ) {}\n\n  private _getRefreshTokenAction(fromInit?: boolean): AuthApiActions.RefreshToken {\n    const accessToken = this.jwtHelperService.tokenGetter();\n    const exp = this.jwtHelperService.getTokenExpirationDate(accessToken) || new Date();\n    const refreshDelay = Math.max(0, Math.round((exp.getTime() - new Date().getTime()) * 0.8));\n    return new AuthApiActions.RefreshToken({refreshDelay, fromInit});\n  }\n\n  private _getScopesFromToken(token: any): string[] {\n    const scopesPath = this.config.scopesPath || ['scopes'];\n    scopesPath.forEach(p => token = token[p]);\n    return token;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\n\nimport {EffectsModule} from '@ngrx/effects';\nimport {StoreModule} from '@ngrx/store';\n\nimport {AuthService} from './auth';\nimport {AuthEffects} from './auth-effects';\nimport {AuthGuard} from './auth-guard';\nimport {JwtHelperService} from './jwt-helper';\nimport {JwtInterceptor} from './jwt-interceptor';\nimport {reducers} from './reducers';\n\n@NgModule({\n  imports: [\n    StoreModule.forFeature('auth', reducers),\n    EffectsModule.forFeature([AuthEffects]),\n  ],\n  providers: [\n    AuthEffects,\n    AuthGuard,\n    AuthService,\n    JwtHelperService,\n    JwtInterceptor\n  ]\n})\nexport class AuthModule { }\n"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__decorate","decorators","target","key","desc","d","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__metadata","metadataKey","metadataValue","metadata","LoginSuccess","payload","type","AuthApiActionTypes","LoginFailure","LoginRedirect","RefreshToken","InitUser","AuthActionTypes","InitUserComplete","InitComplete","Logout","LogoutConfirmationDismiss","initialState","init","user","token","reducer","state","action","tslib_1.__assign","AuthActions.AuthActionTypes","Login","LoginPageActionTypes","error","pending","reducers","status","fromAuth.reducer","loginPage","fromLoginPage.reducer","selectAuthState","createFeatureSelector","selectAuthStatusState","createSelector","getInit","getUser","getLoggedIn","selectLoginPageState","getLoginPageError","getLoginPagePending","AUTH_OPTIONS","InjectionToken","providedIn","factory","loginUrl","logoutUrl","refreshTokenUrl","meUrl","JWT_OPTIONS","JwtHelperService","config","tokenGetter","tokenSetter","refreshTokenGetter","refreshTokenSetter","urlBase64Decode","str","output","replace","Error","b64DecodeUnicode","b64decode","String","bc","bs","buffer","idx","charAt","fromCharCode","indexOf","decodeURIComponent","Array","map","charCodeAt","toString","slice","join","decodeToken","parts","split","decoded","JSON","parse","getTokenExpirationDate","date","Date","setUTCSeconds","exp","isTokenExpired","offsetSeconds","valueOf","Injectable","args","undefined","Inject","JwtInterceptor","jwtHelper","headerName","authScheme","whitelistedDomains","blacklistedRoutes","throwNoTokenError","skipWhenExpired","isWhitelistedDomain","request","requestUrl","URLParse","url","host","findIndex","domain","RegExp","test","isBlacklistedRoute","route","handleInterception","next","tokenIsExpired","clone","setHeaders","_a","handle","intercept","AuthService","_http","_config","login","credentials","post","logout","refreshToken","refresh_token","getCurrentUser","get","HttpClient","AuthGuard","store","canActivate","_guard","canActivateChild","_cr","_state","_this","pipe","select","fromAuth.getInit","filter","switchMap","fromAuth.getLoggedIn","authed","dispatch","AuthApiActions.LoginRedirect","take","Store","LoginComponent","fb","_cdr","_loginEvt","EventEmitter","_loginSub","Subscription","EMPTY","loginForm","group","username","Validators","required","password","valid","valueChanges","subscribe","LoginPageActions.Login","value","_disabled","disabled","forceBooleanProp","markForCheck","ngOnDestroy","unsubscribe","complete","AuthEffects","actions$","authService","jwtHelperService","userInteractionsService","router","ts","initUser$","ofType","exhaustMap","catchError","_","obsOf","of","AuthActions.InitUserComplete","initUserComplete$","AuthActions.InitComplete","login$","LoginPageActions.LoginPageActionTypes","auth","res","AuthApiActions.LoginSuccess","err","errors","message","push","zip","e","AuthApiActions.LoginFailure","loginSuccess$","AuthApiActions.AuthApiActionTypes","tap","tokenKey","refreshTokenKey","navigate","_getRefreshTokenAction","loginFailure$","showLoginError","refreshToken$","delayWhen","timer","refreshDelay","fromInit","AuthActions.InitUser","loginRedirect$","_authed","logoutConfirmation$","askLogoutConfirm","result","AuthActions.Logout","AuthActions.LogoutConfirmationDismiss","init$","defer","AuthApiActions.RefreshToken","scopes","disableScopes","_getScopesFromToken","accessToken","Math","max","round","getTime","scopesPath","forEach","Actions","AuthUserInteractionsService","Router","TranslateService","tslib_1.__decorate","Effect","AuthModule","NgModule","imports","StoreModule","forFeature","EffectsModule","providers"],"mappings":"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"}