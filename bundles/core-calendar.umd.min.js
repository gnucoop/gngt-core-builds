/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Gnucoop Angular Toolkit (gngt).
 *
 * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("date-fns")):"function"==typeof define&&define.amd?define("@gngt/core/calendar",["exports","@angular/core","@angular/forms","date-fns"],t):t(((e=e||self).gngt=e.gngt||{},e.gngt.core=e.gngt.core||{},e.gngt.core.calendar={}),e.ng.core,e.ng.forms,e.dateFns)}(this,function(e,t,i,f){"use strict";function n(){}function a(){}var r={provide:i.NG_VALUE_ACCESSOR,useExisting:t.forwardRef(function(){return d}),multi:!0},s=["","monday","tuesday","wednesday","thursday","friday","saturday","sunday"],_=(o.prototype.toString=function(){return"day"===this.type?""+this.date.getDate():"month"===this.type?f.format(this.date,"MMM"):""+this.date.getFullYear()},o.prototype.getRange=function(){if("day"===this.type)return{start:new Date(this.date),end:new Date(this.date)};var e=new Date(this.date);return{start:"month"===this.type?f.startOfMonth(e):f.startOfYear(e),end:"month"===this.type?f.endOfMonth(e):f.endOfYear(e)}},o);function o(e){this.disabled=!1,this.highlight=!1;var t=Object.keys(e);this.type=e.type,this.date=e.date,this.selected=e.selected,-1<t.indexOf("disabled")&&(this.disabled=e.disabled),-1<t.indexOf("highlight")&&(this.highlight=e.highlight)}var d=(Object.defineProperty(h.prototype,"viewDate",{get:function(){return this._viewDate},set:function(e){this._setViewDate(e)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"disabled",{get:function(){return this._disabled},set:function(e){var t=null!=e&&""+e!="false";t!==this._disabled&&(this._disabled=t,this._cdr.markForCheck())},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"dateOnlyForDay",{get:function(){return this._disabled},set:function(e){this._dateOnlyForDay=null!=e&&""+e!="false"},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"viewMode",{get:function(){return this._viewMode},set:function(e){this._viewMode=e,this._buildCalendar()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"selectionMode",{get:function(){return this._selectionMode},set:function(e){this._selectionMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"startOfWeekDay",{get:function(){return s[this._startOfWeekDay]},set:function(e){this._startOfWeekDay=s.indexOf(e),"month"===this._viewMode&&this._buildCalendar()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"isoMode",{get:function(){return this._isoMode},set:function(e){this._isoMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"minDate",{get:function(){return this._minDate},set:function(e){this._minDate=null!=e?new Date(e.valueOf()):null},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"maxDate",{get:function(){return this._maxDate},set:function(e){this._maxDate=null!=e?new Date(e.valueOf()):null},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"change",{get:function(){return this._change.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"selectedPeriod",{set:function(e){this._selectedPeriod=e,this._change.emit({source:this,period:e}),this._refreshSelection()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"value",{get:function(){return this._dateOnlyForDay&&"day"===this.selectionMode?null!=this._selectedPeriod?this._selectedPeriod.startDate:null:this._selectedPeriod},set:function(e){this._dateOnlyForDay&&"day"===this.selectionMode?e instanceof Date&&(null==this._selectedPeriod||e!==this._selectedPeriod.startDate)&&(this.selectedPeriod={type:"day",startDate:e,endDate:e},this._onChangeCallback(e)):e instanceof Object&&e!==this._selectedPeriod&&(this.selectedPeriod=e,this._onChangeCallback(e))},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"calendarRows",{get:function(){return this._calendarRows},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"viewHeader",{get:function(){return this._viewHeader},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"weekDays",{get:function(){return this._weekDays},enumerable:!0,configurable:!0}),h.prototype.prevPage=function(){"month"==this._viewMode?this.viewDate=f.subMonths(this.viewDate,1):"year"==this._viewMode&&(this.viewDate=f.subYears(this.viewDate,1)),this._buildCalendar()},h.prototype.nextPage=function(){"month"==this._viewMode?this.viewDate=f.addMonths(this.viewDate,1):"year"==this._viewMode&&(this.viewDate=f.addYears(this.viewDate,1)),this._buildCalendar()},h.prototype.previousViewMode=function(){"decade"!=this._viewMode&&("year"==this._viewMode?this._viewMode="decade":"month"==this._viewMode&&(this._viewMode="year"),this._buildCalendar())},h.prototype.selectEntry=function(e){if(!this._canSelectEntry(e))return this._nextViewMode(e);var t=null;if("full"==this._isEntrySelected(e))t=null;else if("day"==this._selectionMode)t={type:"day",startDate:e.date,endDate:e.date};else if("week"==this._selectionMode)t={type:"week",startDate:this._isoMode?f.startOfISOWeek(e.date):f.startOfWeek(e.date,{weekStartsOn:this._startOfWeekDay}),endDate:this._isoMode?f.endOfISOWeek(e.date):f.endOfWeek(e.date,{weekStartsOn:this._startOfWeekDay})};else if("month"==this._selectionMode){var i=this._getMonthStartEnd(e.date);t={type:"month",startDate:new Date(i.start),endDate:new Date(i.end)}}else"year"==this._selectionMode&&(t={type:"year",startDate:f.startOfYear(e.date),endDate:f.endOfYear(e.date)});this.value=t,this._cdr.markForCheck()},h.prototype.registerOnChange=function(e){this._onChangeCallback=e},h.prototype.registerOnTouched=function(e){this._onTouchedCallback=e},h.prototype.writeValue=function(e){"string"==typeof e&&(e=f.parse(e)),this.value=e},h.prototype.ngOnInit=function(){this._buildCalendar()},h.prototype.ngAfterContentInit=function(){this._refreshSelection()},h.prototype._setViewDate=function(e){this._viewDate=e},h.prototype._getMonthStartEnd=function(e){var t=f.startOfMonth(e),i=f.endOfMonth(e);if(this._isoMode){var n=t.getDay(),a=i.getDay();(0==n||4<n)&&(t=f.addWeeks(t,1)),0<a&&a<4&&(i=f.subWeeks(i,1)),t=f.startOfISOWeek(t),i=f.endOfISOWeek(i)}return{start:t,end:i}},h.prototype._buildCalendar=function(){"month"==this._viewMode?this._buildMonthView():"year"==this._viewMode?this._buildYearView():"decade"==this._viewMode&&this._buildDecadeView(),this._cdr.markForCheck()},h.prototype._buildDecadeView=function(){var e=this._viewDate.getFullYear(),t=e-e%10+1,i=11+t;this._viewHeader=t+" - "+i;var n=f.startOfYear(this._viewDate);n.setFullYear(t);for(var a=[],r=0;r<4;r++){for(var s=[],o=0;o<3;o++){var d=new Date(n),h=new _({type:"year",date:d,selected:"none"});h.selected=this._isEntrySelected(h),s.push(h),n=f.addYears(n,1)}a.push(s)}this._calendarRows=a},h.prototype._buildYearView=function(){this._viewHeader=""+this._viewDate.getFullYear();for(var e=f.startOfYear(this._viewDate),t=[],i=0;i<4;i++){for(var n=[],a=0;a<3;a++){var r=new Date(e),s=new _({type:"month",date:r,selected:"none"});s.selected=this._isEntrySelected(s),n.push(s),e=f.addMonths(e,1)}t.push(n)}this._calendarRows=t},h.prototype._buildMonthView=function(){this._viewHeader=f.format(this._viewDate,"MMM YYYY"),this._buildMonthViewWeekDays();var e=this._getMonthStartEnd(this._viewDate),t=new Date(e.start),i=new Date(e.end);this._isoMode||(t=f.startOfWeek(t),i=f.endOfWeek(i));for(var n=[],a=new Date,r=new Date(t),s=null==this.minDate?null:new Date(this.minDate),o=null==this.maxDate?null:new Date(this.maxDate);r<i;){for(var d=[],h=0;h<7;h++){var l=null!=s&&f.isBefore(r,s)||null!=o&&f.isAfter(r,o),u=new Date(r),c=new _({type:"day",date:u,selected:"none",highlight:f.format(a,"YYYY-MM-DD")===f.format(r,"YYYY-MM-DD"),disabled:l});c.selected=this._isEntrySelected(c),d.push(c),r=f.addDays(r,1)}n.push(d)}this._calendarRows=n},h.prototype._buildMonthViewWeekDays=function(){var e;e=this._isoMode?f.setISODay(f.startOfWeek(this._viewDate),1):f.startOfWeek(this._viewDate);for(var t=[],i=0;i<7;i++)t.push(f.format(e,"dddd")),e=f.addDays(e,1);this._weekDays=t,this._cdr.markForCheck()},h.prototype._periodOrder=function(e){return["day","week","month","year"].indexOf(e)},h.prototype._isEntrySelected=function(e){if(null!=this._selectedPeriod&&null!=this._selectedPeriod.startDate&&null!=this._selectedPeriod.endDate){var t=f.startOfDay(this._selectedPeriod.startDate),i=f.endOfDay(this._selectedPeriod.endDate),n=this._periodOrder(this._selectedPeriod.type),a=this._periodOrder(e.type),r=e.getRange();if(a<=n&&this._isBetween(r.start,t,i)&&this._isBetween(r.end,t,i))return"full";if(n<a&&this._isBetween(t,r.start,r.end)&&this._isBetween(i,r.start,r.end))return"partial"}return"none"},h.prototype._isBetween=function(e,t,i){return(f.isAfter(e,t)||f.isSameDay(e,t))&&(f.isBefore(e,i)||f.isSameDay(e,i))},h.prototype._refreshSelection=function(){for(var e=0,t=this._calendarRows;e<t.length;e++)for(var i=0,n=t[e];i<n.length;i++){var a=n[i];a.selected=this._isEntrySelected(a)}},h.prototype._canSelectEntry=function(e){return!(0<=["day","week"].indexOf(this._selectionMode)&&"day"!=e.type||"month"==this._selectionMode&&"year"==e.type)},h.prototype._nextViewMode=function(e){if("decade"==this._viewMode)this._viewMode="year";else if("year"==this._viewMode)this._viewMode="month";else if("month"==this._viewMode)return;this._viewDate=e.date,this._buildCalendar()},h);function h(e){this._cdr=e,this._disabled=!1,this._dateOnlyForDay=!1,this._viewMode="month",this._selectionMode="day",this._startOfWeekDay=1,this._isoMode=!1,this._change=new t.EventEmitter,this._viewDate=new Date,this._viewHeader="",this._calendarRows=[],this._weekDays=[],this._onChangeCallback=function(e){},this._onTouchedCallback=function(e){}}e.CALENDAR_CONTROL_VALUE_ACCESSOR=r,e.Calendar=d,e.CalendarChange=a,e.CalendarEntry=_,e.CalendarPeriod=n,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=core-calendar.umd.min.js.map
