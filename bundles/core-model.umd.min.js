/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Gnucoop Angular Toolkit (gngt).
 *
 * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@gngt/core/reducers"),require("rxjs"),require("rxjs/operators"),require("@ngrx/effects"),require("@angular/core"),require("@ngrx/store")):"function"==typeof define&&define.amd?define("@gngt/core/model",["exports","@gngt/core/reducers","rxjs","rxjs/operators","@ngrx/effects","@angular/core","@ngrx/store"],t):t(((e=e||self).dewco=e.dewco||{},e.dewco.core=e.dewco.core||{},e.dewco.core.model={}),e.gngt.core.reducers,e.rxjs,e.rxjs.operators,e.ngrx.effects,e.ng.core,e.ngrx.store)}(this,function(e,t,i,c,l,r,d){"use strict";var o=function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};var n=function(e){this.payload=e},s=function(e){this.payload=e},a=function(e){this.payload=e},u=function(e){this.payload=e},p=function(e){this.payload=e},h=function(e){this.payload=e},f=function(e){this.payload=e},_=function(e){this.payload=e},y=function(e){this.payload=e},g=function(e){this.payload=e},S=function(e){this.payload=e},m=function(e){this.payload=e},A=function(e){this.payload=e},E=function(e){this.payload=e},j=function(e){this.payload=e},b=function(e){this.payload=e},T=function(e){this.payload=e},L=function(e){this.payload=e},U=function(e){this.payload=e},C=function(e){this.payload=e},w=function(e){this.payload=e},M=function(e){this.payload=e},D=function(e){this.payload=e},P=function(e){this.payload=e},F=Object.freeze({ModelActionTypes:function(){},generateModelActionTypes:function(e){return{LIST:t.type("["+e+"] List"),LIST_FAILURE:t.type("["+e+"] List failure"),LIST_SUCCESS:t.type("["+e+"] List success"),GET:t.type("["+e+"] Get"),GET_FAILURE:t.type("["+e+"] Get failure"),GET_SUCCESS:t.type("["+e+"] Get success"),CREATE:t.type("["+e+"] Create"),CREATE_FAILURE:t.type("["+e+"] Create failure"),CREATE_SUCCESS:t.type("["+e+"] Create success"),UPDATE:t.type("["+e+"] Update"),UPDATE_FAILURE:t.type("["+e+"] Update failure"),UPDATE_SUCCESS:t.type("["+e+"] Update success"),PATCH:t.type("["+e+"] Patch"),PATCH_FAILURE:t.type("["+e+"] Patch failure"),PATCH_SUCCESS:t.type("["+e+"] Patch success"),DELETE:t.type("["+e+"] Delete"),DELETE_FAILURE:t.type("["+e+"] Delete failure"),DELETE_SUCCESS:t.type("["+e+"] Delete success"),DELETE_ALL:t.type("["+e+"] Delete all"),DELETE_ALL_FAILURE:t.type("["+e+"] Delete all failure"),DELETE_ALL_SUCCESS:t.type("["+e+"] Delete all success"),QUERY:t.type("["+e+"] Query"),QUERY_FAILURE:t.type("["+e+"] Query failure"),QUERY_SUCCESS:t.type("["+e+"] Query success")}},ModelGetAction:n,ModelGetSuccessAction:s,ModelGetFailureAction:a,ModelListAction:u,ModelListSuccessAction:p,ModelListFailureAction:h,ModelCreateAction:f,ModelCreateSuccessAction:_,ModelCreateFailureAction:y,ModelUpdateAction:g,ModelUpdateSuccessAction:S,ModelUpdateFailureAction:m,ModelPatchAction:A,ModelPatchSuccessAction:E,ModelPatchFailureAction:j,ModelDeleteAction:b,ModelDeleteSuccessAction:T,ModelDeleteFailureAction:L,ModelDeleteAllAction:U,ModelDeleteAllSuccessAction:C,ModelDeleteAllFailureAction:w,ModelQueryAction:M,ModelQuerySuccessAction:D,ModelQueryFailureAction:P});function I(){return{get:{loading:!1,options:{id:null},id:null,object:null,error:null},list:{loading:!1,options:{},objects:null,error:null},create:{loading:!1,object:null,error:null},update:{loading:!1,id:null,object:null,error:null},patch:{loading:!1,id:null,object:null,error:null},delete:{loading:!1,id:null,object:null,error:null},deleteAll:{loading:!1,ids:null,objects:null,error:null},query:{loading:!1,options:null,objects:null,error:null}}}function O(e,t,r){switch(t.type){case r.GET:return o({},e,{get:o({},e.get,{loading:!0,options:{id:null},id:t.payload.id,object:null,error:null})});case r.GET_SUCCESS:return o({},e,{get:o({},e.get,{loading:!1,object:t.payload.item,error:null})});case r.GET_FAILURE:return o({},e,{get:o({},e.get,{loading:!1,object:null,error:t.payload.error})});case r.LIST:return o({},e,{list:o({},e.list,{loading:!0,options:t.payload.params,objects:null,error:null})});case r.LIST_SUCCESS:return o({},e,{list:o({},e.list,{loading:!1,objects:t.payload.result,error:null})});case r.LIST_FAILURE:return o({},e,{list:o({},e.list,{loading:!1,objects:null,error:t.payload.error})});case r.CREATE:return o({},e,{create:o({},e.create,{loading:!0,object:t.payload.item,error:null})});case r.CREATE_SUCCESS:return o({},e,{create:o({},e.create,{loading:!1,object:t.payload.item,error:null})});case r.CREATE_FAILURE:return o({},e,{create:o({},e.create,{loading:!1,object:null,error:t.payload.error})});case r.UPDATE:return o({},e,{update:o({},e.update,{loading:!0,id:t.payload.item.id,object:t.payload.item,error:null})});case r.UPDATE_SUCCESS:return o({},e,{update:o({},e.update,{loading:!1,object:t.payload.item,error:null})});case r.UPDATE_FAILURE:return o({},e,{update:o({},e.update,{loading:!1,object:null,error:t.payload.error})});case r.PATCH:return o({},e,{patch:o({},e.patch,{loading:!0,id:t.payload.item.id,object:t.payload.item,error:null})});case r.PATCH_SUCCESS:return o({},e,{patch:o({},e.patch,{loading:!1,object:t.payload.item,error:null})});case r.PATCH_FAILURE:return o({},e,{patch:o({},e.patch,{loading:!1,object:null,error:t.payload.error})});case r.DELETE:return o({},e,{delete:o({},e.delete,{loading:!0,id:t.payload.item.id,object:null,error:null})});case r.DELETE_SUCCESS:return o({},e,{delete:o({},e.delete,{loading:!1,object:t.payload.item,error:null})});case r.DELETE_FAILURE:return o({},e,{delete:o({},e.delete,{loading:!1,object:null,error:t.payload.error})});case r.DELETE_ALL:return o({},e,{deleteAll:o({},e.deleteAll,{loading:!0,ids:t.payload.items.map(function(e){return e.id}),objects:null,error:null})});case r.DELETE_ALL_SUCCESS:return o({},e,{deleteAll:o({},e.deleteAll,{loading:!1,objects:t.payload.items,error:null})});case r.DELETE_ALL_FAILURE:return o({},e,{deleteAll:o({},e.deleteAll,{loading:!1,objects:null,error:t.payload.error})});case r.QUERY:return o({},e,{list:o({},e.list,{loading:!0,options:t.payload.params,objects:null,error:null})});case r.QUERY_SUCCESS:return o({},e,{list:o({},e.list,{loading:!1,objects:t.payload.result,error:null})});case r.QUERY_FAILURE:return o({},e,{list:o({},e.list,{loading:!1,objects:null,error:t.payload.error})});default:return e}}var R=Object.freeze({ModelPackageState:function(){},generateInitialModelState:I,modelReducer:O}),q=function(e,t,r,o){var n=this;this._actions=e,this._service=t,this._manager=r,this._params=o,this.modelGet$=this._actions.pipe(l.ofType(this._params.getActionType),c.switchMap(function(e){return n._manager.get(e.payload.id).pipe(c.map(function(e){return new n._params.getSuccessAction({item:e})}),c.catchError(function(e){return i.of(new n._params.getFailureAction({error:e}))}))})),this.modelList$=this._actions.pipe(l.ofType(this._params.listActionType),c.switchMap(function(e){return n._manager.list(e.payload.params).pipe(c.map(function(e){return new n._params.listSuccessAction({result:e})}),c.catchError(function(e){return i.of(new n._params.listFailureAction({error:e}))}))})),this.modelCreate$=this._actions.pipe(l.ofType(this._params.createActionType),c.switchMap(function(e){return n._manager.create(e.payload.item).pipe(c.map(function(e){return new n._params.createSuccessAction({item:e})}),c.catchError(function(e){return i.of(new n._params.createFailureAction({error:e}))}))})),this.modelUpdate$=this._actions.pipe(l.ofType(this._params.updateActionType),c.switchMap(function(e){return n._manager.update(e.payload.item.id,e.payload.item).pipe(c.map(function(e){return new n._params.updateSuccessAction({item:e})}),c.catchError(function(e){return i.of(new n._params.updateFailureAction({error:e}))}))})),this.modelPatch$=this._actions.pipe(l.ofType(this._params.patchActionType),c.switchMap(function(e){return n._manager.patch(e.payload.item.id,e.payload.item).pipe(c.map(function(e){return new n._params.patchSuccessAction({item:e})}),c.catchError(function(e){return i.of(new n._params.patchFailureAction({error:e}))}))})),this.modelDelete$=this._actions.pipe(l.ofType(this._params.deleteActionType),c.switchMap(function(e){return n._manager.delete(e.payload.item.id).pipe(c.map(function(){return new n._params.deleteSuccessAction({item:e.payload.item})}),c.catchError(function(e){return i.of(new n._params.deleteFailureAction({error:e}))}))})),this.modelDeleteAll$=this._actions.pipe(l.ofType(this._params.deleteAllActionType),c.switchMap(function(e){return n._manager.deleteAll(e.payload.items.map(function(e){return e.id})).pipe(c.map(function(){return new n._params.deleteAllSuccessAction({items:e.payload.items})}),c.catchError(function(e){return i.of(new n._params.deleteAllFailureAction({error:e}))}))})),this.modelQuery$=this._actions.pipe(l.ofType(this._params.queryActionType),c.switchMap(function(e){return n._manager.query(e.payload.params).pipe(c.map(function(e){return new n._params.querySuccessAction({result:e})}),c.catchError(function(e){return i.of(new n._params.queryFailureAction({error:e}))}))}))},Q=function(){function e(e,t,r){this._config=e,this._endPoint=t,this._http=r,this._baseUrl=""+this._config.baseApiUrl+this._endPoint}return Object.defineProperty(e.prototype,"endPoint",{get:function(){return this._endPoint},enumerable:!0,configurable:!0}),e.prototype.get=function(e){return this._http.get(this._getObjectUrl(e))},e.prototype.list=function(e){var t=this._listParamsToQueryParameters(e);return this._http.get(""+this._getListUrl()+t)},e.prototype.create=function(e){return this._http.post(this._getListUrl(),e)},e.prototype.update=function(e,t){return this._http.put(this._getObjectUrl(e),t)},e.prototype.patch=function(e,t){return this._http.patch(this._getObjectUrl(e),t)},e.prototype.delete=function(e){return this._http.delete(this._getObjectUrl(e))},e.prototype.deleteAll=function(e){var t=this._baseUrl+"/delete_all";return this._config.addTrailingSlash&&(t+="/"),this._http.post(t,{ids:e})},e.prototype.query=function(e){var t=this._baseUrl+"/query";return this._config.addTrailingSlash&&(t+="/"),this._http.post(t,e)},e.prototype._getObjectUrl=function(e){var t=this._baseUrl+"/"+e;return this._config.addTrailingSlash&&(t+="/"),t},e.prototype._getListUrl=function(){var e=this._baseUrl;return this._config.addTrailingSlash&&(e+="/"),e},e.prototype._listParamsToQueryParameters=function(t){var e="",r=[];if(t){if(t.limit&&r.push("limit="+t.limit),t.start&&r.push("start="+t.start),t.sort){var o=Object.keys(t.sort);r.push("sort="+o.map(function(e){return e+":"+t.sort[e]}).join(","))}t.fields&&r.push("fields="+t.fields.join(",")),t.joins&&r.push("joins="+t.joins.map(function(e){var t=e.model+"."+e.property;return e.fields?t+"."+e.fields.join(";"):t}).join(",")),0<r.length&&(e="?"+r.join("&"))}return e},e}(),v=new r.InjectionToken("MODEL_OPTIONS",{providedIn:"root",factory:function(){return{baseApiUrl:"/"}}});var x=function(){function e(e,t,r,o,n,i,c,l,s,a,u){this._store=e,this._actions=t,this._getAction=r,this._listAction=o,this._createAction=n,this._updateAction=i,this._patchAction=c,this._deleteAction=l,this._deleteAllAction=s,this._queryAction=a;var p=d.createFeatureSelector(u[0]);this._modelState=d.createSelector(p,function(e){return e[u[1]]})}return e.prototype.getGetLoading=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.get.loading})))},e.prototype.getGetOptions=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.get.options})))},e.prototype.getGetId=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.get.id})))},e.prototype.getGetObject=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.get.object})))},e.prototype.getGetError=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.get.error})))},e.prototype.getListLoading=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.list.loading})))},e.prototype.getListOptions=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.list.options})))},e.prototype.getListObjects=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.list.objects})))},e.prototype.getListError=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.list.error})))},e.prototype.getListHasNext=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.list.objects&&e.list.objects.next})))},e.prototype.getListCurrentStart=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.list.options&&null!=e.list.options.start?e.list.options.start:1})))},e.prototype.getCreateLoading=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.create.loading})))},e.prototype.getCreateObject=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.create.object})))},e.prototype.getCreateError=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.create.error})))},e.prototype.getUpdateLoading=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.update.loading})))},e.prototype.getUpdateId=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.update.id})))},e.prototype.getUpdateObject=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.update.object})))},e.prototype.getUpdateError=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.update.error})))},e.prototype.getPatchLoading=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.patch.loading})))},e.prototype.getPatchId=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.patch.id})))},e.prototype.getPatchObject=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.patch.object})))},e.prototype.getPatchError=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.patch.error})))},e.prototype.getDeleteLoading=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.delete.loading})))},e.prototype.getDeleteId=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.delete.id})))},e.prototype.getDeleteObject=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.delete.object})))},e.prototype.getDeleteError=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.delete.error})))},e.prototype.getDeleteAllLoading=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.deleteAll.loading})))},e.prototype.getDeleteAllIds=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.deleteAll.ids})))},e.prototype.getDeleteAllObjects=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.deleteAll.objects})))},e.prototype.getDeleteAllError=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.deleteAll.error})))},e.prototype.getQueryLoading=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.query.loading})))},e.prototype.getQueryOptions=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.query.options})))},e.prototype.getQueryObjects=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.query.objects})))},e.prototype.getQueryError=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.query.error})))},e.prototype.getQueryHasNext=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.query.objects&&e.query.objects.next})))},e.prototype.getQueryCurrentStart=function(){return this._store.pipe(d.select(d.createSelector(this._modelState,function(e){return e.query.options&&null!=e.query.options.start?e.query.options.start:1})))},e.prototype.getCreateSuccess=function(){return this._actions.pipe(l.ofType(new this._createAction(null).type))},e.prototype.getUpdateSuccess=function(){return this._actions.pipe(l.ofType(new this._updateAction(null).type))},e.prototype.getPatchSuccess=function(){return this._actions.pipe(l.ofType(new this._patchAction(null).type))},e.prototype.getDeleteSuccess=function(){return this._actions.pipe(l.ofType(new this._deleteAction(null).type))},e.prototype.getDeleteAllSuccess=function(){return this._actions.pipe(l.ofType(new this._deleteAllAction(null).type))},e.prototype.get=function(e){this._store.dispatch(function(e,t){return new e({id:t})}(this._getAction,e))},e.prototype.list=function(e){this._store.dispatch(function(e,t){return new e({params:t})}(this._listAction,e||{}))},e.prototype.create=function(e){this._store.dispatch(function(e,t){return new e({item:t})}(this._createAction,e))},e.prototype.update=function(e){this._store.dispatch(function(e,t){return new e({item:t})}(this._updateAction,e))},e.prototype.patch=function(e){this._store.dispatch(function(e,t){return new e({item:t})}(this._patchAction,e))},e.prototype.delete=function(e){this._store.dispatch(function(e,t){return new e({item:t})}(this._deleteAction,e))},e.prototype.deleteAll=function(e){this._store.dispatch(function(e,t){return new e({items:t})}(this._deleteAllAction,e))},e.prototype.query=function(e){this._store.dispatch(function(e,t){return new e({params:t})}(this._queryAction,e||{}))},e}();e.MODEL_OPTIONS=v,e.ModelActions=F,e.ModelEffects=q,e.ModelManager=Q,e.ModelService=x,e.generateInitialModelState=I,e.modelReducer=O,e.reducers=R,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=core-model.umd.min.js.map
