/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Gnucoop Angular Toolkit (gngt).
 *
 * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/cdk/coercion"),require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@gngt/core/model")):"function"==typeof define&&define.amd?define("@gngt/core/admin",["exports","@angular/cdk/coercion","@angular/core","rxjs","rxjs/operators","@gngt/core/model"],t):t(((e=e||self).gngt=e.gngt||{},e.gngt.core=e.gngt.core||{},e.gngt.core.admin={}),e.ng.cdk.coercion,e.ng.core,e.rxjs,e.rxjs.operators)}(this,function(e,t,s,c,a){"use strict";function r(){}var u=function(){return(u=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},n=(Object.defineProperty(i.prototype,"title",{get:function(){return this._title},set:function(e){this._title=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"listUrl",{set:function(e){this._listUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cancelLabel",{get:function(){return this._cancelLabel},set:function(e){this._cancelLabel=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"saveLabel",{get:function(){return this._saveLabel},set:function(e){this._saveLabel=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"service",{set:function(e){this._service.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fields",{get:function(){return this._fields},set:function(e){this._fields=e,this._updateForm()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"id",{set:function(e){this._id.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"processObject",{set:function(e){this._processObject=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"processFormData",{set:function(e){this._processFormData=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"readonly",{get:function(){return this._readonly},set:function(e){(e=t.coerceBooleanProperty(e))!==this._readonly&&(this._readonly=e,this._cdr.markForCheck())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hideSaveButton",{get:function(){return this._hideSaveButton},set:function(e){(e=t.coerceBooleanProperty(e))!==this._hideSaveButton&&(this._hideSaveButton=e,this._cdr.markForCheck())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canSave",{get:function(){return this._canSave},set:function(e){(e=t.coerceBooleanProperty(e))!==this._canSave&&(this._canSave=e,this._cdr.markForCheck())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"valueChanges$",{get:function(){return this._valueChanges$},enumerable:!0,configurable:!0}),i.prototype.goBack=function(){this._router.navigate([this._listUrl])},i.prototype.save=function(){this._saveEvt.emit()},i.prototype.ngOnDestroy=function(){this._updateFormEvt.complete(),this._saveEvt.complete(),this._saveSub.unsubscribe()},i.prototype._defaultProcessData=function(t){this._fields.forEach(function(e){if(e.subtype)switch(e.subtype){case"number":null!=t[e.name]&&"string"==typeof t[e.name]&&(t[e.name].includes(".")?t[e.name]=parseFloat(t[e.name]):t[e.name]=parseInt(t[e.name]))}})},i.prototype._updateForm=function(){this._updateFormEvt.emit()},i.propDecorators={title:[{type:s.Input}],listUrl:[{type:s.Input}],cancelLabel:[{type:s.Input}],saveLabel:[{type:s.Input}],service:[{type:s.Input}],fields:[{type:s.Input}],id:[{type:s.Input}],processObject:[{type:s.Input}],processFormData:[{type:s.Input}],readonly:[{type:s.Input}],hideSaveButton:[{type:s.Input}],canSave:[{type:s.Input}],valueChanges$:[{type:s.Output}]},i);function i(e,t,r){var o=this;this._cdr=e,this._fb=t,this._router=r,this._title="",this._cancelLabel="Cancel",this._saveLabel="Save",this._service=new c.BehaviorSubject(null),this._fields=[],this._id=new c.BehaviorSubject(null),this._loading=new c.BehaviorSubject(!1),this.loading=this._loading.asObservable(),this._updateFormEvt=new s.EventEmitter,this._saveEvt=new s.EventEmitter,this._saveSub=c.Subscription.EMPTY,this._processFormData=this._defaultProcessData;var n=c.combineLatest(this._service,this._id).pipe(a.filter(function(e){var t=e[0],r=e[1];return null!=t&&null!=r}),a.switchMap(function(e){var t=e[0],r=e[1];return"new"===r?c.of({}):(t.get(r),t.getGetObject())}),a.filter(function(e){return null!=e}),a.switchMap(function(t){if(o._processObject){if(o._processObject instanceof c.Observable)return o._processObject.pipe(a.tap(function(e){return e(t)}),a.mapTo(t));o._processObject(t)}return c.of(t)}),a.shareReplay(1));this.form=c.combineLatest(n,this._updateFormEvt).pipe(a.map(function(e){var n=e[0];return o._fb.group((o._fields||[]).reduce(function(e,t){var r=n?n[t.name]:null;return e[t.name]=[r,t.validators],e},{}))}),a.shareReplay(1)),this._valueChanges$=this.form.pipe(a.switchMap(function(e){return e.valueChanges}));var i=this._service.pipe(a.filter(function(e){return null!=e}));this._saveSub=this._saveEvt.pipe(a.withLatestFrom(this.form,i,this._id),a.filter(function(e){e[0];var t=e[1],r=e[2];e[3];return null!=t&&null!=r&&t.valid}),a.switchMap(function(e){e[0];var t=e[1],r=e[2],n=e[3],i=u({},t.value);if(o._defaultProcessData(i),o._processFormData){if(o._processFormData instanceof c.Observable)return o._processFormData.pipe(a.tap(function(e){return e(i)}),a.mapTo([i,r,n]));o._processFormData(i)}return c.of([i,r,n])}),a.tap(function(){return o._loading.next(!0)}),a.switchMap(function(e){var t=e[0],r=e[1];return"new"===e[2]?(delete t.id,r.create(t)):r.patch(t)}),a.take(1)).subscribe(function(){o._loading.next(!1),o.goBack()},function(){return o._loading.next(!1)})}var o=(Object.defineProperty(l.prototype,"title",{get:function(){return this._title},set:function(e){this._title=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"headers",{get:function(){return this._headers},set:function(e){this._headers=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"displayedColumns",{get:function(){return this._displayedColumns},set:function(e){this._displayedColumns=["select"].concat(e),this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"baseEditUrl",{get:function(){return this._baseEditUrl},set:function(e){this._baseEditUrl=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"newItemPath",{get:function(){return this._newItemPath},set:function(e){this._newItemPath=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"service",{set:function(e){this._service=e,this._initService()},enumerable:!0,configurable:!0}),l.prototype.isAllSelected=function(){return this.getSelection().length===this.getItems().length},l.prototype.masterToggle=function(){this.isAllSelected()?this.clearSelection():this.selectAll()},l.prototype.ngOnDestroy=function(){this._deletionSub.unsubscribe(),this._deletionEvt.complete()},l.prototype.processAction=function(e){var t=this.getSelection();if(t&&0!==t.length){var r=this._getActionHandler(e),n=this[r];null!=n&&n.call(this,t)}},l.prototype.processDeleteAction=function(t){var r=this;if(null!=this._service)var n=this._aui.askDeleteConfirm().subscribe(function(e){n&&n.unsubscribe(),e&&(1===t.length?r._service.delete(t[0]):r._service.deleteAll(t),r._actionProcessed.emit("delete"),r.clearSelection())})},l.prototype._getService=function(){return this._service},l.prototype._getActionHandler=function(e){return"process"+(e=e.charAt(0).toUpperCase()+e.substring(1))+"Action"},l.prototype._initService=function(){var n=this;this._deletionSub.unsubscribe(),this._deletionSub=this._deletionEvt.pipe(a.switchMap(function(t){return n._aui.askDeleteConfirm().pipe(a.map(function(e){return{res:e,selected:t}}))}),a.switchMap(function(e){var t=e.res,r=e.selected;return t?1===r.length?n._service.delete(r[0]):n._service.deleteAll(r):c.of(null)}),a.filter(function(e){return null!=e}),a.take(1)).subscribe(function(){n._actionProcessed.emit("delete"),n.clearSelection(),n.refreshList()})},l);function l(e,t){this._cdr=e,this._aui=t,this._headers=[],this._displayedColumns=[],this._baseEditUrl="",this._newItemPath="new",this._actionProcessed=new s.EventEmitter,this.actionProcessed=this._actionProcessed.asObservable(),this._deletionEvt=new s.EventEmitter,this._deletionSub=c.Subscription.EMPTY}e.AdminEditComponent=n,e.AdminEditFieldSubtype={Color:"color",Date:"date",DateTimeLocal:"datetime-local",Email:"email",Month:"month",Number:"number",Password:"password",Search:"search",Tel:"tel",Text:"text",Time:"time",Url:"url",Week:"week"},e.AdminEditFieldType={Input:"input",TextArea:"textarea",CheckBox:"checkbox",Radio:"radio",Select:"select",MultipleSelect:"multipleselect",Autocomplete:"autocomplete"},e.AdminListComponent=o,e.AdminUserInteractionsService=r,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=core-admin.umd.min.js.map
