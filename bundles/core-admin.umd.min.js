/**
 * @license
 * Copyright (C) 2018 Gnucoop soc. coop.
 *
 * This file is part of the Gnucoop Angular Toolkit (gngt).
 *
 * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.
 *
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@gngt/core/model")):"function"==typeof define&&define.amd?define("@gngt/core/admin",["exports","@angular/core","rxjs","rxjs/operators","@gngt/core/model"],t):t(((e=e||self).dewco=e.dewco||{},e.dewco.core=e.dewco.core||{},e.dewco.core.admin={}),e.ng.core,e.rxjs,e.rxjs.operators)}(this,function(e,o,c,a){"use strict";var u=function(){return(u=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},t=function(){},r=function(){function e(e,t,r){var s=this;this._cdr=e,this._fb=t,this._router=r,this._title="",this._cancelLabel="Cancel",this._saveLabel="Save",this._service=new c.BehaviorSubject(null),this._fields=[],this._id=new c.BehaviorSubject(null),this._processObject=function(e){},this._processFormData=function(e){},this._updateFormEvt=new o.EventEmitter,this._saveEvt=new o.EventEmitter,this._saveSub=c.Subscription.EMPTY,this._savedSub=c.Subscription.EMPTY,this._processFormData=this._defaultProcessData;var i=c.combineLatest(this._service,this._id).pipe(a.filter(function(e){var t=e[0],r=e[1];return null!=t&&null!=r}),a.switchMap(function(e){var t=e[0],r=e[1];return"new"===r?c.of({}):(t.get(r),t.getGetObject())}),a.filter(function(e){return null!=e}),a.tap(function(e){s._processObject&&s._processObject(e)}),a.shareReplay(1));this.form=c.combineLatest(i,this._updateFormEvt).pipe(a.map(function(e){var i=e[0];return s._fb.group((s._fields||[]).reduce(function(e,t){var r=i?i[t.name]:null;return e[t.name]=[r,t.validators],e},{}))}),a.shareReplay(1)),this._valueChanges$=this.form.pipe(a.switchMap(function(e){return e.valueChanges})),this._saveSub=this._saveEvt.pipe(a.withLatestFrom(this.form,this._service,this._id),a.filter(function(e){return null!=e[2]})).subscribe(function(e){e[0];var t=e[1],r=e[2],i=e[3];if(null!=t&&(null!=r||t.valid)){var n=u({},t.value);s._applyProcessFormData(n),"new"===i?(delete n.id,r.create(n)):r.patch(n)}});var n=this._service.pipe(a.filter(function(e){return null!=e}));this.loading=n.pipe(a.filter(function(e){return null!=e}),a.switchMap(function(e){return c.merge(e.getGetLoading(),e.getCreateLoading(),e.getPatchLoading())})),this._savedSub=n.pipe(a.filter(function(e){return null!=e}),a.switchMap(function(e){return c.merge(e.getCreateSuccess(),e.getPatchSuccess())})).subscribe(function(){return s.goBack()})}return Object.defineProperty(e.prototype,"title",{get:function(){return this._title},set:function(e){this._title=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listUrl",{set:function(e){this._listUrl=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cancelLabel",{get:function(){return this._cancelLabel},set:function(e){this._cancelLabel=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"saveLabel",{get:function(){return this._saveLabel},set:function(e){this._saveLabel=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"service",{set:function(e){this._service.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fields",{get:function(){return this._fields},set:function(e){this._fields=e,this._updateForm()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{set:function(e){this._id.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"processObject",{set:function(e){this._processObject=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"processFormData",{set:function(e){this._processFormData=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueChanges$",{get:function(){return this._valueChanges$},enumerable:!0,configurable:!0}),e.prototype.goBack=function(){this._router.navigate([this._listUrl])},e.prototype.save=function(){this._saveEvt.emit()},e.prototype.ngOnDestroy=function(){this._updateFormEvt.complete(),this._saveEvt.complete(),this._saveSub.unsubscribe(),this._savedSub.unsubscribe()},e.prototype._applyProcessFormData=function(e){this._defaultProcessData(e),this._processFormData(e)},e.prototype._defaultProcessData=function(t){this._fields.forEach(function(e){if(e.subtype)switch(e.subtype){case"number":null!=t[e.name]&&"string"==typeof t[e.name]&&(t[e.name].includes(".")?t[e.name]=parseFloat(t[e.name]):t[e.name]=parseInt(t[e.name]))}})},e.prototype._updateForm=function(){this._updateFormEvt.emit()},e.propDecorators={title:[{type:o.Input}],listUrl:[{type:o.Input}],cancelLabel:[{type:o.Input}],saveLabel:[{type:o.Input}],service:[{type:o.Input}],fields:[{type:o.Input}],id:[{type:o.Input}],processObject:[{type:o.Input}],processFormData:[{type:o.Input}],valueChanges$:[{type:o.Output}]},e}(),i=function(){function e(e,t){this._cdr=e,this._aui=t,this._headers=[],this._displayedColumns=[],this._baseEditUrl="",this._newItemPath="new",this._actionProcessed=new o.EventEmitter,this.actionProcessed=this._actionProcessed.asObservable(),this._deletionSub=c.Subscription.EMPTY}return Object.defineProperty(e.prototype,"title",{get:function(){return this._title},set:function(e){this._title=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headers",{get:function(){return this._headers},set:function(e){this._headers=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayedColumns",{get:function(){return this._displayedColumns},set:function(e){this._displayedColumns=["select"].concat(e),this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseEditUrl",{get:function(){return this._baseEditUrl},set:function(e){this._baseEditUrl=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"newItemPath",{get:function(){return this._newItemPath},set:function(e){this._newItemPath=e,this._cdr.markForCheck()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"service",{set:function(e){this._service=e,this._initService()},enumerable:!0,configurable:!0}),e.prototype.isAllSelected=function(){return this.getSelection().length===this.getItems().length},e.prototype.masterToggle=function(){this.isAllSelected()?this.clearSelection():this.selectAll()},e.prototype.ngOnDestroy=function(){this._deletionSub.unsubscribe()},e.prototype.processAction=function(e){var t=this.getSelection();if(t&&0!==t.length){var r=this._getActionHandler(e),i=this[r];null!=i&&i.call(this,t)}},e.prototype.processDeleteAction=function(t){var r=this;if(null!=this._service)var i=this._aui.askDeleteConfirm().subscribe(function(e){i&&i.unsubscribe(),e&&(1===t.length?r._service.delete(t[0]):r._service.deleteAll(t),r._actionProcessed.emit("delete"),r.clearSelection())})},e.prototype._getService=function(){return this._service},e.prototype._getActionHandler=function(e){return"process"+(e=e.charAt(0).toUpperCase()+e.substring(1))+"Action"},e.prototype._initService=function(){var e=this;this._deletionSub=c.merge(this._service.getDeleteSuccess(),this._service.getDeleteAllSuccess()).subscribe(function(){return e.refreshList()})},e}();e.AdminEditComponent=r,e.AdminEditFieldSubtype={Color:"color",Date:"date",DateTimeLocal:"datetime-local",Email:"email",Month:"month",Number:"number",Password:"password",Search:"search",Tel:"tel",Text:"text",Time:"time",Url:"url",Week:"week"},e.AdminEditFieldType={Input:"input",TextArea:"textarea",CheckBox:"checkbox",Radio:"radio",Select:"select",MultipleSelect:"multipleselect",Autocomplete:"autocomplete"},e.AdminListComponent=i,e.AdminUserInteractionsService=t,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=core-admin.umd.min.js.map
