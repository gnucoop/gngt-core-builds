{"version":3,"file":"auth.js","sources":["../../../../../../src/core/auth/auth-actions.ts","../../../../../../src/core/auth/auth-api-actions.ts","../../../../../../src/core/auth/auth-reducer.ts","../../../../../../src/core/auth/login-page-reducer.ts","../../../../../../src/core/auth/reducers.ts","../../../../../../src/core/auth/auth-options.ts","../../../../../../src/core/auth/credentials.ts","../../../../../../src/core/auth/jwt-options.ts","../../../../../../src/core/auth/jwt-token.ts","../../../../../../src/core/auth/login-response.ts","../../../../../../src/core/auth/user.ts","../../../../../../src/core/auth/auth-options-token.ts","../../../../../../src/core/auth/jwt-options-token.ts","../../../../../../src/core/auth/jwt-helper.ts","../../../../../../src/core/auth/jwt-interceptor.ts","../../../../../../src/core/auth/auth.ts","../../../../../../src/core/auth/auth-helper.ts","../../../../../../src/core/auth/auth-guard.ts","../../../../../../src/core/auth/auth-user-interactions.ts","../../../../../../src/core/auth/login-page-actions.ts","../../../../../../src/core/auth/login.ts","../../../../../../src/core/auth/auth-module-options.ts","../../../../../../src/core/auth/auth-effects.ts","../../../../../../src/core/auth/auth-module.ts","../../../../../../src/core/auth/public-api.ts","../../../../../../src/core/auth/index.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\n\nimport {User} from './user';\n\n\nexport const enum AuthActionTypes {\n  Init = '[Auth] Init',\n  InitUser = '[Auth] Init user',\n  InitUserComplete = '[Auth] Init user complete',\n  InitComplete = '[Auth] Init complete',\n  Logout = '[Auth] Logout',\n  LogoutConfirmation = '[Auth] Logout Confirmation',\n  LogoutConfirmationDismiss = '[Auth] Logout Confirmation Dismiss',\n}\n\nexport class Init implements Action {\n  readonly type = AuthActionTypes.Init;\n}\n\nexport class InitUser implements Action {\n  readonly type = AuthActionTypes.InitUser;\n}\n\nexport class InitUserComplete implements Action {\n  readonly type = AuthActionTypes.InitUserComplete;\n\n  constructor(public payload: {user: User|null}) {}\n}\n\nexport class InitComplete implements Action {\n  readonly type = AuthActionTypes.InitComplete;\n}\n\nexport class Logout implements Action {\n  readonly type = AuthActionTypes.Logout;\n}\n\nexport class LogoutConfirmation implements Action {\n  readonly type = AuthActionTypes.LogoutConfirmation;\n}\n\nexport class LogoutConfirmationDismiss implements Action {\n  readonly type = AuthActionTypes.LogoutConfirmationDismiss;\n}\n\nexport type AuthActionsUnion =\n    Init|InitUser|InitUserComplete|InitComplete|Logout|LogoutConfirmation|LogoutConfirmationDismiss;\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\nimport {LoginResponse} from './login-response';\n\nexport const enum AuthApiActionTypes {\n  LoginSuccess = '[Auth/API] Login Success',\n  LoginFailure = '[Auth/API] Login Failure',\n  LoginRedirect = '[Auth/API] Login Redirect',\n  RefreshToken = '[Auth/API] Refresh token'\n}\n\nexport class LoginSuccess implements Action {\n  readonly type = AuthApiActionTypes.LoginSuccess;\n\n  constructor(public payload: LoginResponse) {}\n}\n\nexport class LoginFailure implements Action {\n  readonly type = AuthApiActionTypes.LoginFailure;\n\n  constructor(public payload: {error: any}) {}\n}\n\nexport class LoginRedirect implements Action {\n  readonly type = AuthApiActionTypes.LoginRedirect;\n}\n\nexport class RefreshToken implements Action {\n  readonly type = AuthApiActionTypes.RefreshToken;\n\n  constructor(public payload: {refreshDelay: number, fromInit?: boolean}) {}\n}\n\nexport type AuthApiActionsUnion = LoginSuccess|LoginFailure|LoginRedirect|RefreshToken;\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  AuthActionsUnion,\n  AuthActionTypes,\n} from './auth-actions';\nimport {AuthApiActionsUnion, AuthApiActionTypes} from './auth-api-actions';\nimport {User} from './user';\n\nexport interface State {\n  init: boolean;\n  user: User|null;\n  token: string|null;\n}\n\nexport const initialState: State = {\n  init: false,\n  user: null,\n  token: null\n};\n\nexport function reducer(state = initialState, action: AuthApiActionsUnion|AuthActionsUnion): State {\n  switch (action.type) {\n    case AuthApiActionTypes.LoginSuccess: {\n      return {\n        ...state,\n        user: action.payload.user,\n      };\n    }\n\n    case AuthActionTypes.Logout: {\n      return {\n        ...state,\n        user: null,\n      };\n    }\n\n    case AuthActionTypes.InitUserComplete: {\n      return {...state, init: true, user: action.payload.user};\n    }\n\n    case AuthActionTypes.InitComplete: {\n      return {...state, init: true};\n    }\n\n    default: {\n      return state;\n    }\n  }\n}\n\nexport const getInit = (state: State) => state.init;\nexport const getUser = (state: State) => state.user;\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AuthApiActionsUnion, AuthApiActionTypes} from './auth-api-actions';\nimport {LoginPageActionsUnion, LoginPageActionTypes} from './login-page-actions';\n\nexport interface State {\n  error: string|null;\n  pending: boolean;\n}\n\nexport const initialState: State = {\n  error: null,\n  pending: false,\n};\n\nexport function reducer(\n    state = initialState, action: AuthApiActionsUnion|LoginPageActionsUnion): State {\n  switch (action.type) {\n    case LoginPageActionTypes.Login: {\n      return {\n        ...state,\n        error: null,\n        pending: true,\n      };\n    }\n\n    case AuthApiActionTypes.LoginSuccess: {\n      return {\n        ...state,\n        error: null,\n        pending: false,\n      };\n    }\n\n    case AuthApiActionTypes.LoginFailure: {\n      return {\n        ...state,\n        error: action.payload.error,\n        pending: false,\n      };\n    }\n\n    default: {\n      return state;\n    }\n  }\n}\n\nexport const getError = (state: State) => state.error;\nexport const getPending = (state: State) => state.pending;\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport * as fromRoot from '@gngt/core/reducers';\nimport {\n  ActionReducerMap,\n  createFeatureSelector,\n  createSelector,\n  MemoizedSelector\n} from '@ngrx/store';\n\nimport {AuthApiActionsUnion} from './auth-api-actions';\nimport * as fromAuth from './auth-reducer';\nimport * as fromLoginPage from './login-page-reducer';\nimport {User} from './user';\n\nexport interface AuthState {\n  status: fromAuth.State;\n  loginPage: fromLoginPage.State;\n}\n\nexport interface State extends fromRoot.State {\n  auth: AuthState;\n}\n\nexport const reducers: ActionReducerMap<AuthState, AuthApiActionsUnion> = {\n  status: fromAuth.reducer,\n  loginPage: fromLoginPage.reducer,\n};\n\nexport const selectAuthState: MemoizedSelector<State, AuthState> =\n    createFeatureSelector<State, AuthState>('auth');\n\nexport const selectAuthStatusState: MemoizedSelector<State, fromAuth.State> =\n    createSelector(selectAuthState, (state: AuthState) => state.status);\nexport const getInit: MemoizedSelector<State, boolean> =\n    createSelector(selectAuthStatusState, fromAuth.getInit);\nexport const getUser: MemoizedSelector<State, User|null> =\n    createSelector(selectAuthStatusState, fromAuth.getUser);\nexport const getLoggedIn: MemoizedSelector<State, boolean> =\n    createSelector(getUser, user => user != null);\n\nexport const selectLoginPageState: MemoizedSelector<State, fromLoginPage.State> =\n    createSelector(selectAuthState, (state: AuthState) => state.loginPage);\nexport const getLoginPageError: MemoizedSelector<State, string|null> =\n    createSelector(selectLoginPageState, fromLoginPage.getError);\nexport const getLoginPagePending: MemoizedSelector<State, boolean> =\n    createSelector(selectLoginPageState, fromLoginPage.getPending);\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {User} from './user';\n\nexport interface AuthOptions {\n  loginUrl: string;\n  logoutUrl: string;\n  refreshTokenUrl: string;\n  meUrl: string;\n  disableScopes?: boolean;\n  scopesPath?: string[];\n  tokenKey?: string;\n  refreshTokenKey?: string;\n  loggedInUserGetter?: () => number | null;\n  loggedInUserSetter?: (id: number|null) => void;\n  meGetter?: () => User | null;\n  meSetter?: (user: User|null) => void;\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport interface Credentials {\n  username: string;\n  password: string;\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport interface JwtOptions {\n  tokenGetter?: () => string | null;\n  tokenSetter?: (token: string|null) => void;\n  refreshTokenGetter?: () => string | null;\n  refreshTokenSetter?: (refreshToken: string|null) => void;\n  headerName?: string;\n  authScheme?: string;\n  whitelistedDomains?: string[];\n  blacklistedRoutes?: string[];\n  throwNoTokenError?: boolean;\n  skipWhenExpired?: boolean;\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport interface JwtToken {\n  user_id: number;\n  scopes: string[];\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {User} from './user';\n\nexport interface LoginResponse {\n  user: User;\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport interface User {\n  id: number;\n  username: string;\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {InjectionToken} from '@angular/core';\n\nimport {AuthOptions} from './auth-options';\n\n\nexport const AUTH_OPTIONS: InjectionToken<AuthOptions> = new InjectionToken<\n    AuthOptions>('AUTH_OPTIONS', {\n  providedIn: 'root',\n  factory: () =>\n      ({loginUrl: '/login', logoutUrl: '/logout', refreshTokenUrl: '/refresh_token', meUrl: '/me'})\n});\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {InjectionToken} from '@angular/core';\n\nimport {JwtOptions} from './jwt-options';\n\n\nexport const JWT_OPTIONS = new InjectionToken<JwtOptions>('JWT_OPTIONS', {\n  providedIn: 'root',\n  factory: () => ({}),\n});\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Inject, Injectable} from '@angular/core';\n\nimport {JwtOptions} from './jwt-options';\nimport {JWT_OPTIONS} from './jwt-options-token';\nimport {JwtToken} from './jwt-token';\n\n\n@Injectable({providedIn: 'root'})\nexport class JwtHelperService {\n  tokenGetter: () => string | null;\n  tokenSetter: (token: string|null) => void;\n  refreshTokenGetter: () => string | null;\n  refreshTokenSetter: (refreshToken: string|null) => void;\n\n  constructor(@Inject(JWT_OPTIONS) config: JwtOptions) {\n    this.tokenGetter = config && config.tokenGetter ? config.tokenGetter : () => null;\n    this.tokenSetter = config && config.tokenSetter ? config.tokenSetter : () => null;\n    this.refreshTokenGetter =\n        config && config.refreshTokenGetter ? config.refreshTokenGetter : () => null;\n    this.refreshTokenSetter =\n        config && config.refreshTokenSetter ? config.refreshTokenSetter : () => null;\n  }\n\n  urlBase64Decode(str: string): string {\n    let output = str.replace(/-/g, '+').replace(/_/g, '/');\n    switch (output.length % 4) {\n      case 0: {\n        break;\n      }\n      case 2: {\n        output += '==';\n        break;\n      }\n      case 3: {\n        output += '=';\n        break;\n      }\n      default: {\n        throw new Error('Illegal base64url string!');\n      }\n    }\n    return this._b64DecodeUnicode(output);\n  }\n\n  // credits for decoder goes to https://github.com/atk\n  private _b64decode(str: string): string {\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    let output = '';\n\n    str = String(str).replace(/=+$/, '');\n\n    if (str.length % 4 === 1) {\n      throw new Error('\\'atob\\' failed: The string to be decoded is not correctly encoded.');\n    }\n\n    for (\n        // tslint:disable\n        // initialize result and counters\n        let bc = 0, bs: any, buffer: any, idx = 0;\n        // get next character\n        (buffer = str.charAt(idx++));\n        // character found in table? initialize bit storage and add its ascii value;\n        ~buffer &&\n                ((bs = bc % 4 ? bs * 64 + buffer : buffer),\n                 // and if not first of each 4 characters,\n                 // convert the first 8 bits to one ascii character\n                 bc++ % 4) ?\n            (output += String.fromCharCode(255 & (bs >> ((-2 * bc) & 6)))) :\n            0) {\n      // try to find character in table (0-63, not found => -1)\n      buffer = chars.indexOf(buffer);\n      // tslint:enable\n    }\n    return output;\n  }\n\n  private _b64DecodeUnicode(str: any) {\n    return decodeURIComponent(Array.prototype.map\n                                  .call(\n                                      this._b64decode(str),\n                                      (c: any) => {\n                                        return '%' +\n                                            ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n                                      })\n                                  .join(''));\n  }\n\n  decodeToken(token: string|null = this.tokenGetter()): JwtToken|null {\n    if (token === null) {\n      return null;\n    }\n\n    const parts = token.split('.');\n\n    if (parts.length !== 3) {\n      throw new Error(\n          'The inspected token doesn\\'t appear to be a JWT. ' +\n          'Check to make sure it has three parts and see https://jwt.io for more.');\n    }\n\n    const decoded = this.urlBase64Decode(parts[1]);\n    if (!decoded) {\n      throw new Error('Cannot decode the token.');\n    }\n\n    return JSON.parse(decoded) as JwtToken;\n  }\n\n  getTokenExpirationDate(token: string|null = this.tokenGetter()): Date|null {\n    let decoded: any;\n    decoded = this.decodeToken(token);\n\n    if (!decoded.hasOwnProperty('exp')) {\n      return null;\n    }\n\n    const date = new Date(0);\n    date.setUTCSeconds(decoded.exp);\n\n    return date;\n  }\n\n  isTokenExpired(token: string|null = this.tokenGetter(), offsetSeconds?: number): boolean {\n    if (token === null || token === '') {\n      return true;\n    }\n    const date = this.getTokenExpirationDate(token);\n    offsetSeconds = offsetSeconds || 0;\n\n    if (date === null) {\n      return true;\n    }\n\n    return !(date.valueOf() > new Date().valueOf() + offsetSeconds * 1000);\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {HttpEvent, HttpHandler, HttpInterceptor, HttpRequest} from '@angular/common/http';\nimport {Inject, Injectable} from '@angular/core';\nimport {Observable} from 'rxjs';\nimport * as URLParse from 'url-parse';\n\nimport {JwtHelperService} from './jwt-helper';\nimport {JwtOptions} from './jwt-options';\nimport {JWT_OPTIONS} from './jwt-options-token';\n\n\n@Injectable({providedIn: 'root'})\nexport class JwtInterceptor implements HttpInterceptor {\n  tokenGetter: (() => string | null)|undefined;\n  headerName: string;\n  authScheme: string;\n  whitelistedDomains: (string|RegExp)[];\n  blacklistedRoutes: (string|RegExp)[];\n  throwNoTokenError: boolean;\n  skipWhenExpired: boolean;\n\n  constructor(@Inject(JWT_OPTIONS) config: JwtOptions, public jwtHelper: JwtHelperService) {\n    this.tokenGetter = config.tokenGetter;\n    this.headerName = config.headerName || 'Authorization';\n    this.authScheme = config.authScheme || config.authScheme === '' ? config.authScheme : 'Bearer ';\n    this.whitelistedDomains = config.whitelistedDomains || [];\n    this.blacklistedRoutes = config.blacklistedRoutes || [];\n    this.throwNoTokenError = config.throwNoTokenError || false;\n    this.skipWhenExpired = config.skipWhenExpired || false;\n  }\n\n  isWhitelistedDomain(request: HttpRequest<any>): boolean {\n    const requestUrl = new URLParse(request.url);\n\n    return (requestUrl.host === null || this.whitelistedDomains.findIndex(domain => {\n      if (typeof domain === 'string') {\n        return domain === requestUrl.host;\n      }\n      return domain instanceof RegExp ? domain.test(requestUrl.host) : false;\n    }) > -1);\n  }\n\n  isBlacklistedRoute(request: HttpRequest<any>): boolean {\n    const url = request.url;\n\n    return (this.blacklistedRoutes.findIndex(route => {\n      if (typeof route === 'string') {\n        return route === url;\n      }\n      return route instanceof RegExp ? route.test(url) : false;\n    }) > -1);\n  }\n\n  handleInterception(token: string|null, request: HttpRequest<any>, next: HttpHandler) {\n    let tokenIsExpired = false;\n\n    if (!token && this.throwNoTokenError) {\n      throw new Error('Could not get token from tokenGetter function.');\n    }\n\n    if (this.skipWhenExpired) {\n      tokenIsExpired = token ? this.jwtHelper.isTokenExpired(token) : true;\n    }\n\n    if (token && tokenIsExpired && this.skipWhenExpired) {\n      request = request.clone();\n    } else if (token && this.isWhitelistedDomain(request) && !this.isBlacklistedRoute(request)) {\n      request = request.clone({setHeaders: {[this.headerName]: `${this.authScheme}${token}`}});\n    }\n    return next.handle(request);\n  }\n\n  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n    const token = this.tokenGetter ? this.tokenGetter() : null;\n\n    return this.handleInterception(token, request, next);\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {HttpClient} from '@angular/common/http';\nimport {Inject, Injectable} from '@angular/core';\nimport {Observable} from 'rxjs';\n\nimport {AuthOptions} from './auth-options';\nimport {AUTH_OPTIONS} from './auth-options-token';\nimport {Credentials} from './credentials';\nimport {LoginResponse} from './login-response';\nimport {RefreshTokenResponse} from './refresh-token-response';\nimport {User} from './user';\n\n\n@Injectable({providedIn: 'root'})\nexport class AuthService {\n  constructor(private _http: HttpClient, @Inject(AUTH_OPTIONS) private _config: AuthOptions) {}\n\n  login(credentials: Credentials): Observable<LoginResponse> {\n    const url = this._config.loginUrl;\n    return this._http.post<LoginResponse>(url, credentials);\n  }\n\n  logout() {\n    const url = this._config.logoutUrl;\n    return this._http.post<null>(url, {});\n  }\n\n  refreshToken(refreshToken: string): Observable<RefreshTokenResponse> {\n    const url = this._config.refreshTokenUrl;\n    return this._http.post<RefreshTokenResponse>(url, {refresh_token: refreshToken});\n  }\n\n  getCurrentUser(): Observable<User> {\n    const url = this._config.meUrl;\n    return this._http.get<User>(url);\n  }\n\n  getLoggedInUser(): number|null {\n    return this._config.loggedInUserGetter ? this._config.loggedInUserGetter() : null;\n  }\n\n  getMe(): User|null {\n    return this._config.meGetter ? this._config.meGetter() : null;\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable} from '@angular/core';\nimport {Actions, ofType} from '@ngrx/effects';\nimport {Store} from '@ngrx/store';\nimport {Observable, of as obsOf} from 'rxjs';\nimport {map} from 'rxjs/operators';\n\nimport {\n  AuthActionsUnion,\n  AuthActionTypes,\n  Logout,\n  LogoutConfirmation,\n} from './auth-actions';\nimport {State} from './auth-reducer';\n\n@Injectable({providedIn: 'root'})\nexport class AuthHelper {\n  constructor(\n      private _store: Store<State>,\n      private _actions: Actions,\n  ) {}\n\n  logout(requestConfirmation = true): Observable<boolean> {\n    if (!requestConfirmation) {\n      this._store.dispatch(new Logout());\n      return obsOf(true);\n    }\n    this._store.dispatch(new LogoutConfirmation());\n    return this._actions.pipe(\n        ofType<AuthActionsUnion>(\n            AuthActionTypes.Logout,\n            AuthActionTypes.LogoutConfirmationDismiss,\n            ),\n        map(action => action.type === AuthActionTypes.Logout),\n    );\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable} from '@angular/core';\nimport {\n  ActivatedRouteSnapshot,\n  CanActivate,\n  CanActivateChild,\n  RouterStateSnapshot\n} from '@angular/router';\nimport {select, Store} from '@ngrx/store';\nimport {Observable} from 'rxjs';\nimport {concatMap, filter, map, take} from 'rxjs/operators';\n\nimport * as AuthApiActions from './auth-api-actions';\nimport * as fromAuth from './reducers';\n\n@Injectable({providedIn: 'root'})\nexport class AuthGuard implements CanActivate, CanActivateChild {\n  constructor(private _store: Store<fromAuth.State>) {}\n\n  canActivate(): Observable<boolean> {\n    return this._guard();\n  }\n\n  canActivateChild(_cr: ActivatedRouteSnapshot, _state: RouterStateSnapshot): Observable<boolean> {\n    return this._guard();\n  }\n\n  private _guard(): Observable<boolean> {\n    return this._store.pipe(\n        select(fromAuth.getInit), filter(init => init),\n        concatMap(() => this._store.pipe(select(fromAuth.getLoggedIn))), map(authed => {\n          if (!authed) {\n            this._store.dispatch(new AuthApiActions.LoginRedirect());\n            return false;\n          }\n\n          return true;\n        }),\n        take(1));\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Observable} from 'rxjs';\n\nexport abstract class AuthUserInteractionsService {\n  abstract showLoginError(error: string): void;\n  abstract askLogoutConfirm(): Observable<boolean>;\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\n\nimport {Credentials} from './credentials';\n\nexport const enum LoginPageActionTypes {\n  Login = '[Login Page] Login',\n}\n\nexport class Login implements Action {\n  readonly type = LoginPageActionTypes.Login;\n\n  constructor(public payload: {credentials: Credentials}) {}\n}\n\nexport type LoginPageActionsUnion = Login;\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {coerceBooleanProperty} from '@angular/cdk/coercion';\nimport {ChangeDetectorRef, Directive, EventEmitter, Input, OnDestroy} from '@angular/core';\nimport {FormBuilder, FormGroup, Validators} from '@angular/forms';\nimport {forceBooleanProp} from '@gngt/core/common';\nimport {Store} from '@ngrx/store';\nimport {Observable, Subscription} from 'rxjs';\nimport {map} from 'rxjs/operators';\n\nimport * as LoginPageActions from './login-page-actions';\nimport * as fromAuth from './reducers';\n\n@Directive({selector: '[gngtLoginUsername]'})\nexport class LoginUsernameDirective {\n}\n\n@Directive({selector: '[gngtLoginPassword]'})\nexport class LoginPasswordDirective {\n}\n\n@Directive({selector: '[gngtLoginAction]'})\nexport class LoginActionDirective {\n}\n\n@Directive()\nexport abstract class LoginComponent implements OnDestroy {\n  readonly loginForm: FormGroup;\n  readonly valid: Observable<boolean>;\n\n  private _disabled: boolean;\n  get disabled(): boolean {\n    return this._disabled;\n  }\n  @Input()\n  set disabled(disabled: boolean) {\n    this._disabled = forceBooleanProp(disabled);\n    this._cdr.markForCheck();\n  }\n\n  private _usernamePlaceholder: string;\n  @Input()\n  get usernamePlaceholder(): string {\n    return this._usernamePlaceholder;\n  }\n  set usernamePlaceholder(usernamePlaceholder: string) {\n    this._usernamePlaceholder = usernamePlaceholder;\n    this._cdr.markForCheck();\n  }\n\n  private _passwordPlaceholder: string;\n  @Input()\n  get passwordPlaceholder(): string {\n    return this._passwordPlaceholder;\n  }\n  set passwordPlaceholder(passwordPlaceholder: string) {\n    this._passwordPlaceholder = passwordPlaceholder;\n    this._cdr.markForCheck();\n  }\n\n  private _showLabels = true;\n  get showLabels(): boolean {\n    return this._showLabels;\n  }\n  @Input()\n  set showLabels(showLabels: boolean) {\n    this._showLabels = coerceBooleanProperty(showLabels);\n    this._cdr.markForCheck();\n  }\n\n  private _loginEvt: EventEmitter<void> = new EventEmitter<void>();\n  private _loginSub: Subscription = Subscription.EMPTY;\n\n  constructor(fb: FormBuilder, store: Store<fromAuth.State>, protected _cdr: ChangeDetectorRef) {\n    this.loginForm = fb.group(\n        {username: [null, [Validators.required]], password: [null, [Validators.required]]});\n\n    this.valid = this.loginForm.valueChanges.pipe(map(() => this.loginForm.valid));\n\n    this._loginSub = this._loginEvt.subscribe(() => {\n      store.dispatch(new LoginPageActions.Login({credentials: this.loginForm.value}));\n    });\n  }\n\n  login(): void {\n    this._loginEvt.next();\n  }\n\n  ngOnDestroy(): void {\n    this._loginSub.unsubscribe();\n    this._loginEvt.complete();\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Provider} from '@angular/core';\n\nimport {AuthOptions} from './auth-options';\nimport {JwtOptions} from './jwt-options';\n\nexport interface AuthModuleOptions {\n  jwtOptionsProvider?: Provider;\n  jwtConfig?: JwtOptions;\n  authOptionsProvider?: Provider;\n  authConfig?: AuthOptions;\n  loggedInUserGetter?: () => number | null;\n  loggedInUserSetter?: (id: number|null) => void;\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {HttpErrorResponse} from '@angular/common/http';\nimport {Inject, Injectable} from '@angular/core';\nimport {Router} from '@angular/router';\nimport {Actions, createEffect, ofType, OnInitEffects} from '@ngrx/effects';\nimport {TranslateService} from '@ngx-translate/core';\nimport {Observable, of as obsOf, timer, zip} from 'rxjs';\nimport {catchError, delayWhen, exhaustMap, map, mergeMap, switchMap, tap} from 'rxjs/operators';\n\nimport {AuthService} from './auth';\nimport {\n  AuthActionsUnion,\n  AuthActionTypes,\n  Init,\n  InitComplete,\n  InitUser,\n  InitUserComplete,\n  Logout,\n  LogoutConfirmationDismiss,\n} from './auth-actions';\nimport {\n  AuthApiActionsUnion,\n  AuthApiActionTypes,\n  LoginFailure,\n  LoginSuccess,\n  RefreshToken,\n} from './auth-api-actions';\nimport {AuthOptions} from './auth-options';\nimport {AUTH_OPTIONS} from './auth-options-token';\nimport {AuthUserInteractionsService} from './auth-user-interactions';\nimport {Credentials} from './credentials';\nimport {JwtHelperService} from './jwt-helper';\nimport * as LoginPageActions from './login-page-actions';\nimport {User} from './user';\n\nexport type AllAuthActions = AuthActionsUnion|AuthApiActionsUnion;\n\n@Injectable()\nexport class AuthEffects implements OnInitEffects {\n  initUser$: Observable<AuthActionsUnion> = createEffect(\n      () => this._actions$.pipe(\n          ofType<InitUser>(AuthActionTypes.InitUser),\n          exhaustMap(() => this._authService.getCurrentUser().pipe(catchError(_ => {\n            return obsOf(this._config.meGetter != null ? this._config.meGetter() : null);\n          }))),\n          map((u) => {\n            const user = u as User | null;\n            if (this._config.meSetter != null) {\n              this._config.meSetter(user);\n            }\n            return new InitUserComplete({user});\n          }),\n          ));\n\n  initUserComplete$: Observable<AuthActionsUnion> = createEffect(\n      () => this._actions$.pipe(\n          ofType<InitUserComplete>(AuthActionTypes.InitUserComplete),\n          map(() => new InitComplete())));\n\n  login$: Observable<AuthApiActionsUnion> = createEffect(\n      () =>\n          this._actions$.pipe(\n              ofType<LoginPageActions.Login>(LoginPageActions.LoginPageActionTypes.Login),\n              map(action => action.payload.credentials),\n              exhaustMap(\n                  (auth: Credentials) => this._authService.login(auth).pipe(\n                      map((res) => new LoginSuccess(res)), catchError((err: HttpErrorResponse) => {\n                        const errors: string[] = [];\n                        if (err.status === 0 || !err.error.message) {\n                          errors.push('Connection problem. Please try again');\n                        } else {\n                          errors.push(err.error.message);\n                        }\n                        return zip(...errors.map(e => <Observable<string>>this._ts.get(e)))\n                            .pipe(\n                                map(error => new LoginFailure({error})),\n                            );\n                      }))),\n              ) as Observable<AuthApiActionsUnion>);\n\n  loginSuccess$: Observable<AllAuthActions> = createEffect(\n      () => this._actions$.pipe(\n                ofType<LoginSuccess>(AuthApiActionTypes.LoginSuccess),\n                tap((action) => {\n                  const payload = <any>action.payload;\n                  const tokenKey = this._config.tokenKey || 'access_token';\n                  const refreshTokenKey = this._config.refreshTokenKey || 'refresh_token';\n                  this._jwtHelperService.tokenSetter(payload[tokenKey]);\n                  this._jwtHelperService.refreshTokenSetter(payload[refreshTokenKey]);\n                  if (this._config.loggedInUserSetter) {\n                    this._config.loggedInUserSetter(payload.user_id);\n                  }\n                  if (this._config.meSetter != null) {\n                    this._config.meSetter(payload.user);\n                  }\n                  this._router.navigate(['/']);\n                }),\n                mergeMap(\n                    (action) =>\n                        [this._getRefreshTokenAction(),\n                         new InitUserComplete({user: action.payload.user}),\n  ]),\n                ) as Observable<AllAuthActions>);\n\n  loginFailure$: Observable<AuthApiActionsUnion> = createEffect(\n      () => this._actions$.pipe(\n          ofType<LoginFailure>(AuthApiActionTypes.LoginFailure),\n          tap((action) => {\n            this._userInteractionsService.showLoginError(action.payload.error.join('\\n'));\n          }),\n          ),\n      {dispatch: false});\n\n  refreshToken$: Observable<AllAuthActions> = createEffect(\n      () => this._actions$.pipe(\n                ofType<RefreshToken>(AuthApiActionTypes.RefreshToken),\n                delayWhen((action: RefreshToken) => timer(action.payload.refreshDelay)),\n                exhaustMap(\n                    (action: RefreshToken) =>\n                        this._authService\n                            .refreshToken(this._jwtHelperService.refreshTokenGetter() || '')\n                            .pipe(\n                                switchMap((payload: any) => {\n                                  const res: (AuthApiActionsUnion|AuthActionsUnion)[] = [];\n                                  const tokenKey = this._config.tokenKey || 'access_token';\n                                  this._jwtHelperService.tokenSetter(payload[tokenKey]);\n                                  if (action.payload.fromInit) {\n                                    res.push(new InitUser());\n                                  }\n                                  res.push(this._getRefreshTokenAction());\n                                  return res;\n                                }),\n                                catchError(err => {\n                                  if (err.status === 0) {\n                                    return obsOf(new InitUser());\n                                  }\n                                  return obsOf(new InitComplete());\n                                }),\n                                )),\n                ) as Observable<AllAuthActions>);\n\n  loginRedirect$: Observable<AllAuthActions> = createEffect(\n      () => this._actions$.pipe(\n          ofType(AuthApiActionTypes.LoginRedirect, AuthActionTypes.Logout), tap(_authed => {\n            this._router.navigate(['/login']);\n          })),\n      {dispatch: false});\n\n  logoutConfirmation$: Observable<AuthActionsUnion> = createEffect(\n      () => this._actions$.pipe(\n          ofType(AuthActionTypes.LogoutConfirmation),\n          exhaustMap(() => this._userInteractionsService.askLogoutConfirm()),\n          map(result => result ? new Logout() : new LogoutConfirmationDismiss())));\n\n  logout$: Observable<AuthActionsUnion> = createEffect(\n      () => this._actions$.pipe(\n          ofType(AuthActionTypes.Logout),\n          tap(() => {\n            this._jwtHelperService.tokenSetter(null);\n            this._jwtHelperService.refreshTokenSetter(null);\n            if (this._config.loggedInUserSetter != null) {\n              this._config.loggedInUserSetter(null);\n            }\n            if (this._config.meSetter != null) {\n              this._config.meSetter(null);\n            }\n          }),\n          ),\n      {dispatch: false});\n\n  init$: Observable<AllAuthActions> = createEffect(\n      () => this._actions$.pipe(\n                ofType(AuthActionTypes.Init),\n                switchMap(() => {\n                  const res: (AuthApiActionsUnion|AuthActionsUnion)[] = [];\n                  const token = this._jwtHelperService.tokenGetter();\n                  if (token) {\n                    try {\n                      if (!this._jwtHelperService.isTokenExpired(token)) {\n                        const decoded = this._jwtHelperService.decodeToken(token);\n                        const scopes =\n                            this._config.disableScopes ? [] : this._getScopesFromToken(decoded);\n                        if (this._config.disableScopes || scopes.indexOf('admin') > -1) {\n                          res.push(new InitUser());\n                          res.push(this._getRefreshTokenAction());\n                        }\n                      } else {\n                        res.push(new RefreshToken({refreshDelay: 0, fromInit: true}));\n                      }\n                    } catch (e) {\n                      res.push(new InitComplete());\n                    }\n                  } else {\n                    res.push(new InitComplete());\n                  }\n                  return res;\n                }),\n                ) as Observable<AllAuthActions>);\n\n  constructor(\n      private _actions$: Actions, private _authService: AuthService,\n      private _jwtHelperService: JwtHelperService,\n      private _userInteractionsService: AuthUserInteractionsService, private _router: Router,\n      private _ts: TranslateService, @Inject(AUTH_OPTIONS) private _config: AuthOptions) {}\n\n  ngrxOnInitEffects(): Init {\n    return new Init();\n  }\n\n  private _getRefreshTokenAction(fromInit?: boolean): RefreshToken {\n    const accessToken = this._jwtHelperService.tokenGetter();\n    const exp = this._jwtHelperService.getTokenExpirationDate(accessToken) || new Date();\n    const refreshDelay = Math.max(0, Math.round((exp.getTime() - new Date().getTime()) * 0.8));\n    return new RefreshToken({refreshDelay, fromInit});\n  }\n\n  private _getScopesFromToken(token: any): string[] {\n    const scopesPath = this._config.scopesPath || ['scopes'];\n    scopesPath.forEach(p => token = token[p]);\n    return token;\n  }\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\nimport {EffectsModule} from '@ngrx/effects';\nimport {StoreModule} from '@ngrx/store';\n\nimport {AuthService} from './auth';\nimport {AuthEffects} from './auth-effects';\nimport {AuthGuard} from './auth-guard';\nimport {AuthHelper} from './auth-helper';\nimport {JwtHelperService} from './jwt-helper';\nimport {JwtInterceptor} from './jwt-interceptor';\nimport {LoginActionDirective, LoginPasswordDirective, LoginUsernameDirective} from './login';\nimport {reducers} from './reducers';\n\n@NgModule({\n  imports: [\n    EffectsModule.forFeature([AuthEffects]),\n    StoreModule.forFeature('auth', reducers),\n  ],\n  declarations: [\n    LoginActionDirective,\n    LoginPasswordDirective,\n    LoginUsernameDirective,\n  ],\n  exports: [\n    LoginActionDirective,\n    LoginPasswordDirective,\n    LoginUsernameDirective,\n  ],\n  providers: [AuthEffects, AuthGuard, AuthHelper, AuthService, JwtHelperService, JwtInterceptor]\n})\nexport class AuthModule {\n}\n","/**\n * @license\n * Copyright (C) Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nexport * from './auth-actions';\nexport * from './auth-api-actions';\nexport * from './reducers';\nexport * from './auth-options';\nexport * from './credentials';\nexport * from './jwt-options';\nexport * from './jwt-token';\nexport * from './login-response';\nexport * from './user';\nexport * from './auth-options-token';\nexport * from './jwt-interceptor';\nexport * from './jwt-options-token';\nexport * from './auth';\nexport * from './auth-helper';\nexport * from './auth-guard';\nexport * from './jwt-helper';\nexport * from './auth-user-interactions';\nexport * from './login';\nexport * from './auth-module-options';\nexport * from './auth-module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {AuthEffects as ɵgc_gngt_src_core_auth_auth_h} from './auth-effects';\nexport {State as ɵgc_gngt_src_core_auth_auth_a,getInit as ɵgc_gngt_src_core_auth_auth_c,getUser as ɵgc_gngt_src_core_auth_auth_d,reducer as ɵgc_gngt_src_core_auth_auth_b} from './auth-reducer';\nexport {getError as ɵgc_gngt_src_core_auth_auth_f,getPending as ɵgc_gngt_src_core_auth_auth_g,reducer as ɵgc_gngt_src_core_auth_auth_e} from './login-page-reducer';"],"names":["initialState","reducer","getInit","getUser","fromAuth.reducer","fromLoginPage.reducer","fromAuth.getInit","fromAuth.getUser","fromLoginPage.getError","fromLoginPage.getPending","obsOf","fromAuth.getLoggedIn","AuthApiActions.LoginRedirect","LoginPageActions.Login"],"mappings":"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"}