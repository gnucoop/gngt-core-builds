{"version":3,"file":"auth.js","sources":["../../../src/core/auth/auth-module.ts","../../../src/core/auth/auth-effects.ts","../../../src/core/auth/login.ts","../../../src/core/auth/auth-user-interactions.ts","../../../src/core/auth/auth-guard.ts","../../../src/core/auth/auth.ts","../../../src/core/auth/jwt-interceptor.ts","../../../src/core/auth/jwt-helper.ts","../../../src/core/auth/jwt-options-token.ts","../../../src/core/auth/auth-options-token.ts","../../../src/core/auth/reducers.ts","../../../src/core/auth/login-page-reducer.ts","../../../src/core/auth/login-page-actions.ts","../../../src/core/auth/auth-reducer.ts","../../../src/core/auth/auth-actions.ts","../../../src/core/auth/auth-api-actions.ts"],"sourcesContent":["/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {NgModule} from '@angular/core';\n\nimport {EffectsModule} from '@ngrx/effects';\nimport {StoreModule} from '@ngrx/store';\n\nimport {AuthService} from './auth';\nimport {AuthEffects} from './auth-effects';\nimport {AuthGuard} from './auth-guard';\nimport {JwtHelperService} from './jwt-helper';\nimport {JwtInterceptor} from './jwt-interceptor';\nimport {reducers} from './reducers';\n\n@NgModule({\n  imports: [\n    StoreModule.forFeature('auth', reducers),\n    EffectsModule.forFeature([AuthEffects]),\n  ],\n  providers: [\n    AuthEffects,\n    AuthGuard,\n    AuthService,\n    JwtHelperService,\n    JwtInterceptor\n  ]\n})\nexport class AuthModule { }\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {HttpErrorResponse} from '@angular/common/http';\nimport {Inject, Injectable} from '@angular/core';\nimport {Router} from '@angular/router';\n\nimport {defer, Observable, of as obsOf, timer, zip} from 'rxjs';\nimport {catchError, delayWhen, exhaustMap, map, switchMap, tap} from 'rxjs/operators';\n\nimport {Actions, Effect, ofType} from '@ngrx/effects';\n\nimport {TranslateService} from '@ngx-translate/core';\n\nimport {AuthService} from './auth';\nimport * as AuthActions from './auth-actions';\nimport * as AuthApiActions from './auth-api-actions';\nimport {AuthOptions} from './auth-options';\nimport {AUTH_OPTIONS} from './auth-options-token';\nimport {AuthUserInteractionsService} from './auth-user-interactions';\nimport {JwtHelperService} from './jwt-helper';\nimport * as LoginPageActions from './login-page-actions';\nimport {Credentials} from './credentials';\n\n\n@Injectable()\nexport class AuthEffects {\n  @Effect()\n  initUser$ = this.actions$.pipe(\n    ofType<AuthActions.InitUser>(AuthActions.AuthActionTypes.InitUser),\n    exhaustMap(() =>\n      this.authService.getCurrentUser().pipe(catchError(_ => obsOf(null)))\n    ),\n    map((user) => new AuthActions.InitUserComplete({user}))\n  );\n\n  @Effect()\n  initUserComplete$ = this.actions$.pipe(\n    ofType<AuthActions.InitUserComplete>(AuthActions.AuthActionTypes.InitUserComplete),\n    map(() => new AuthActions.InitComplete())\n  );\n\n  @Effect()\n  login$ = this.actions$.pipe(\n    ofType<LoginPageActions.Login>(LoginPageActions.LoginPageActionTypes.Login),\n    map(action => action.payload.credentials),\n    exhaustMap((auth: Credentials) =>\n      this.authService.login(auth).pipe(\n        map((res) => new AuthApiActions.LoginSuccess(res)),\n        catchError((err: HttpErrorResponse) => {\n          const errors: string[] = [];\n          if (err.status === 0 || !err.error.message) {\n            errors.push('Connection problem. Please try again');\n          } else {\n            errors.push(err.error.message);\n          }\n          return zip(...errors.map(e => <Observable<string>>this.ts.get(e)))\n            .pipe(\n              map(error => new AuthApiActions.LoginFailure({error}))\n            );\n        })\n      )\n    )\n  );\n\n  @Effect()\n  loginSuccess$ = this.actions$.pipe(\n    ofType<AuthApiActions.LoginSuccess>(AuthApiActions.AuthApiActionTypes.LoginSuccess),\n    tap((action) => {\n      const payload = <any>action.payload;\n      const tokenKey = this.config.tokenKey || 'access_token';\n      const refreshTokenKey = this.config.refreshTokenKey || 'refresh_token';\n      this.jwtHelperService.tokenSetter(payload[tokenKey]);\n      this.jwtHelperService.refreshTokenSetter(payload[refreshTokenKey]);\n      this.router.navigate(['/']);\n    }),\n    map(() => {\n      return this._getRefreshTokenAction();\n    })\n  );\n\n  @Effect({dispatch: false})\n  loginFailure$ = this.actions$.pipe(\n    ofType<AuthApiActions.LoginFailure>(AuthApiActions.AuthApiActionTypes.LoginFailure),\n    tap((action) => {\n      this.userInteractionsService.showLoginError(action.payload.error.join('\\n'));\n    })\n  );\n\n  @Effect()\n  refreshToken$ = this.actions$.pipe(\n    ofType<AuthApiActions.RefreshToken>(AuthApiActions.AuthApiActionTypes.RefreshToken),\n    delayWhen((action: AuthApiActions.RefreshToken) => timer(action.payload.refreshDelay)),\n    exhaustMap((action: AuthApiActions.RefreshToken) =>\n      this.authService.refreshToken(this.jwtHelperService.refreshTokenGetter() || '').pipe(\n        switchMap((payload: any) => {\n          const res: (AuthApiActions.AuthApiActionsUnion | AuthActions.AuthActionsUnion)[] = [];\n          const tokenKey = this.config.tokenKey || 'access_token';\n          this.jwtHelperService.tokenSetter(payload[tokenKey]);\n          if (action.payload.fromInit) {\n            res.push(new AuthActions.InitUser());\n          }\n          res.push(this._getRefreshTokenAction());\n          return res;\n        }),\n        catchError(() => obsOf(new AuthActions.InitComplete()))\n      )\n    )\n  );\n\n  @Effect({ dispatch: false })\n  loginRedirect$ = this.actions$.pipe(\n    ofType(\n      AuthApiActions.AuthApiActionTypes.LoginRedirect,\n      AuthActions.AuthActionTypes.Logout\n    ),\n    tap(_authed => {\n      this.router.navigate(['/login']);\n    })\n  );\n\n  @Effect()\n  logoutConfirmation$ = this.actions$.pipe(\n    ofType(AuthActions.AuthActionTypes.LogoutConfirmation),\n    exhaustMap(() => this.userInteractionsService.askLogoutConfirm()),\n    map(\n      result =>\n        result\n          ? new AuthActions.Logout()\n          : new AuthActions.LogoutConfirmationDismiss()\n    )\n  );\n\n  @Effect()\n  init$ = defer(() => obsOf(null)).pipe(\n    switchMap(() => {\n      const res: (AuthApiActions.AuthApiActionsUnion | AuthActions.AuthActionsUnion)[] = [];\n      const token = this.jwtHelperService.tokenGetter();\n      if (token) {\n        try {\n          if (!this.jwtHelperService.isTokenExpired(token)) {\n            const decoded = this.jwtHelperService.decodeToken(token);\n            const scopes = this.config.disableScopes ? [] : this._getScopesFromToken(decoded);\n            if (this.config.disableScopes || scopes.indexOf('admin') > -1) {\n              res.push(new AuthActions.InitUser());\n              res.push(this._getRefreshTokenAction());\n            }\n          } else {\n            res.push(new AuthApiActions.RefreshToken({refreshDelay: 0, fromInit: true}));\n          }\n        } catch (e) {\n          res.push(new AuthActions.InitComplete());\n        }\n      } else {\n        res.push(new AuthActions.InitComplete());\n      }\n      return res;\n    })\n  );\n\n  constructor(\n    private actions$: Actions,\n    private authService: AuthService,\n    private jwtHelperService: JwtHelperService,\n    private userInteractionsService: AuthUserInteractionsService,\n    private router: Router,\n    private ts: TranslateService,\n    @Inject(AUTH_OPTIONS) private config: AuthOptions\n  ) {}\n\n  private _getRefreshTokenAction(fromInit?: boolean): AuthApiActions.RefreshToken {\n    const accessToken = this.jwtHelperService.tokenGetter();\n    const exp = this.jwtHelperService.getTokenExpirationDate(accessToken) || new Date();\n    const refreshDelay = Math.max(0, Math.round((exp.getTime() - new Date().getTime()) * 0.8));\n    return new AuthApiActions.RefreshToken({refreshDelay, fromInit});\n  }\n\n  private _getScopesFromToken(token: any): string[] {\n    const scopesPath = this.config.scopesPath || ['scopes'];\n    scopesPath.forEach(p => token = token[p]);\n    return token;\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {ChangeDetectorRef, EventEmitter, OnDestroy} from '@angular/core';\nimport {FormBuilder, FormGroup, Validators} from '@angular/forms';\n\nimport {Observable, Subscription} from 'rxjs';\nimport {map} from 'rxjs/operators';\n\nimport {Store} from '@ngrx/store';\n\nimport {forceBooleanProp} from '@gngt/core/common';\n\nimport * as LoginPageActions from './login-page-actions';\nimport * as fromAuth from './reducers';\n\nexport abstract class LoginComponent implements OnDestroy {\n  readonly loginForm: FormGroup;\n  readonly valid: Observable<boolean>;\n\n  private _disabled: boolean;\n  get disabled(): boolean { return this._disabled; }\n  set disabled(disabled: boolean) {\n    this._disabled = forceBooleanProp(disabled);\n    this._cdr.markForCheck();\n  }\n\n  private _loginEvt: EventEmitter<void> = new EventEmitter<void>();\n  private _loginSub: Subscription = Subscription.EMPTY;\n\n  constructor(fb: FormBuilder, store: Store<fromAuth.State>, private _cdr: ChangeDetectorRef) {\n    this.loginForm = fb.group({\n      username: [null, [Validators.required]],\n      password: [null, [Validators.required]]\n    });\n\n    this.valid = this.loginForm.valueChanges.pipe(\n      map(() => this.loginForm.valid)\n    );\n\n    this._loginSub = this._loginEvt.subscribe(() => {\n      store.dispatch(new LoginPageActions.Login({ credentials: this.loginForm.value }));\n    });\n  }\n\n  login(): void {\n    this._loginEvt.next();\n  }\n\n  ngOnDestroy(): void {\n    this._loginSub.unsubscribe();\n    this._loginEvt.complete();\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Observable} from 'rxjs';\n\nexport abstract class AuthUserInteractionsService {\n  abstract showLoginError(error: string): void;\n  abstract askLogoutConfirm(): Observable<boolean>;\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable} from '@angular/core';\nimport {\n  ActivatedRouteSnapshot, CanActivate, CanActivateChild, RouterStateSnapshot\n} from '@angular/router';\n\nimport {Store, select} from '@ngrx/store';\n\nimport {Observable} from 'rxjs';\nimport {filter, map, switchMap, take} from 'rxjs/operators';\n\nimport * as AuthApiActions from './auth-api-actions';\nimport * as fromAuth from './reducers';\n\n\n@Injectable({providedIn: 'root'})\nexport class AuthGuard implements CanActivate, CanActivateChild {\n  constructor(private store: Store<fromAuth.State>) {}\n\n  canActivate(): Observable<boolean> {\n    return this._guard();\n  }\n\n  canActivateChild(_cr: ActivatedRouteSnapshot, _state: RouterStateSnapshot): Observable<boolean> {\n    return this._guard();\n  }\n\n  private _guard(): Observable<boolean> {\n    return this.store.pipe(\n      select(fromAuth.getInit),\n      filter(init => init),\n      switchMap(() => this.store.pipe(select(fromAuth.getLoggedIn))),\n      map(authed => {\n        if (!authed) {\n          this.store.dispatch(new AuthApiActions.LoginRedirect());\n          return false;\n        }\n\n        return true;\n      }),\n      take(1)\n    );\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {HttpClient} from '@angular/common/http';\nimport {Inject, Injectable} from '@angular/core';\n\nimport {Observable} from 'rxjs';\n\nimport {AuthOptions} from './auth-options';\nimport {AUTH_OPTIONS} from './auth-options-token';\nimport {Credentials} from './credentials';\nimport {LoginResponse} from './login-response';\nimport {RefreshTokenResponse} from './refresh-token-response';\nimport {User} from './user';\n\n\n@Injectable({providedIn: 'root'})\nexport class AuthService {\n  constructor(private _http: HttpClient, @Inject(AUTH_OPTIONS) private _config: AuthOptions) {}\n\n  login(credentials: Credentials): Observable<LoginResponse> {\n    const url = this._config.loginUrl;\n    return this._http.post<LoginResponse>(url, credentials);\n  }\n\n  logout() {\n    const url = this._config.logoutUrl;\n    return this._http.post<null>(url, {});\n  }\n\n  refreshToken(refreshToken: string): Observable<RefreshTokenResponse> {\n    const url = this._config.refreshTokenUrl;\n    return this._http.post<RefreshTokenResponse>(url, {refresh_token: refreshToken});\n  }\n\n  getCurrentUser(): Observable<User> {\n    const url = this._config.meUrl;\n    return this._http.get<User>(url);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable, Inject} from '@angular/core';\nimport {HttpRequest, HttpHandler, HttpEvent, HttpInterceptor} from '@angular/common/http';\n\nimport {Observable} from 'rxjs';\n\nimport * as URLParse from 'url-parse';\n\nimport {JwtHelperService} from './jwt-helper';\nimport {JwtOptions} from './jwt-options';\nimport {JWT_OPTIONS} from './jwt-options-token';\n\n\n@Injectable({providedIn: 'root'})\nexport class JwtInterceptor implements HttpInterceptor {\n  tokenGetter: (() => string | null) | undefined;\n  headerName: string;\n  authScheme: string;\n  whitelistedDomains: Array<string | RegExp>;\n  blacklistedRoutes: Array<string | RegExp>;\n  throwNoTokenError: boolean;\n  skipWhenExpired: boolean;\n\n  constructor(\n    @Inject(JWT_OPTIONS) config: JwtOptions,\n    public jwtHelper: JwtHelperService\n  ) {\n    this.tokenGetter = config.tokenGetter;\n    this.headerName = config.headerName || 'Authorization';\n    this.authScheme =\n      config.authScheme || config.authScheme === ''\n        ? config.authScheme\n        : 'Bearer ';\n    this.whitelistedDomains = config.whitelistedDomains || [];\n    this.blacklistedRoutes = config.blacklistedRoutes || [];\n    this.throwNoTokenError = config.throwNoTokenError || false;\n    this.skipWhenExpired = config.skipWhenExpired || false;\n  }\n\n  isWhitelistedDomain(request: HttpRequest<any>): boolean {\n    const requestUrl = new URLParse(request.url);\n\n    return (\n      requestUrl.host === null ||\n      this.whitelistedDomains.findIndex(\n        domain =>\n          typeof domain === 'string'\n            ? domain === requestUrl.host\n            : domain instanceof RegExp\n              ? domain.test(requestUrl.host)\n              : false\n      ) > -1\n    );\n  }\n\n  isBlacklistedRoute(request: HttpRequest<any>): boolean {\n    const url = request.url;\n\n    return (\n      this.blacklistedRoutes.findIndex(\n        route =>\n          typeof route === 'string'\n            ? route === url\n            : route instanceof RegExp\n              ? route.test(url)\n              : false\n      ) > -1\n    );\n  }\n\n  handleInterception(\n    token: string | null,\n    request: HttpRequest<any>,\n    next: HttpHandler\n  ) {\n    let tokenIsExpired = false;\n\n    if (!token && this.throwNoTokenError) {\n      throw new Error('Could not get token from tokenGetter function.');\n    }\n\n    if (this.skipWhenExpired) {\n      tokenIsExpired = token ? this.jwtHelper.isTokenExpired(token) : true;\n    }\n\n    if (token && tokenIsExpired && this.skipWhenExpired) {\n      request = request.clone();\n    } else if (\n      token &&\n      this.isWhitelistedDomain(request) &&\n      !this.isBlacklistedRoute(request)\n    ) {\n      request = request.clone({\n        setHeaders: {\n          [this.headerName]: `${this.authScheme}${token}`\n        }\n      });\n    }\n    return next.handle(request);\n  }\n\n  intercept(\n    request: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const token = this.tokenGetter ? this.tokenGetter() : null;\n\n    return this.handleInterception(token, request, next);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Injectable, Inject} from '@angular/core';\n\nimport {JwtOptions} from './jwt-options';\nimport {JwtToken} from './jwt-token';\nimport {JWT_OPTIONS} from './jwt-options-token';\n\n\n@Injectable({providedIn: 'root'})\nexport class JwtHelperService {\n  tokenGetter: () => string | null;\n  tokenSetter: (token: string | null) => void;\n  refreshTokenGetter: () => string | null;\n  refreshTokenSetter: (refreshToken: string | null) => void;\n\n  constructor(@Inject(JWT_OPTIONS) config: JwtOptions) {\n    this.tokenGetter = config && config.tokenGetter ?\n      config.tokenGetter : () => null;\n    this.tokenSetter = config && config.tokenSetter ?\n      config.tokenSetter : () => null;\n    this.refreshTokenGetter = config && config.refreshTokenGetter ?\n      config.refreshTokenGetter : () => null;\n    this.refreshTokenSetter = config && config.refreshTokenSetter ?\n      config.refreshTokenSetter : () => null;\n  }\n\n  urlBase64Decode(str: string): string {\n    let output = str.replace(/-/g, '+').replace(/_/g, '/');\n    switch (output.length % 4) {\n      case 0: {\n        break;\n      }\n      case 2: {\n        output += '==';\n        break;\n      }\n      case 3: {\n        output += '=';\n        break;\n      }\n      default: {\n        throw new Error('Illegal base64url string!');\n      }\n    }\n    return this.b64DecodeUnicode(output);\n  }\n\n  // credits for decoder goes to https://github.com/atk\n  private b64decode(str: string): string {\n    const chars =\n      'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    let output = '';\n\n    str = String(str).replace(/=+$/, '');\n\n    if (str.length % 4 === 1) {\n      throw new Error(\n        '\\'atob\\' failed: The string to be decoded is not correctly encoded.'\n      );\n    }\n\n    for (\n       // tslint:disable:no-bitwise\n      // initialize result and counters\n      let bc = 0, bs: any, buffer: any, idx = 0;\n      // get next character\n      (buffer = str.charAt(idx++));\n      // character found in table? initialize bit storage and add its ascii value;\n      ~buffer &&\n      (\n        (bs = bc % 4 ? bs * 64 + buffer : buffer),\n        // and if not first of each 4 characters,\n        // convert the first 8 bits to one ascii character\n        bc++ % 4\n      )\n        ? (output += String.fromCharCode(255 & (bs >> ((-2 * bc) & 6))))\n        : 0\n    ) {\n      // try to find character in table (0-63, not found => -1)\n      buffer = chars.indexOf(buffer);\n       // tslint:enable:no-bitwise\n    }\n    return output;\n  }\n\n  private b64DecodeUnicode(str: any) {\n    return decodeURIComponent(\n      Array.prototype.map\n        .call(this.b64decode(str), (c: any) => {\n          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        })\n        .join('')\n    );\n  }\n\n  decodeToken(token: string | null = this.tokenGetter()): JwtToken | null {\n    if (token === null) {\n      return null;\n    }\n\n    const parts = token.split('.');\n\n    if (parts.length !== 3) {\n      throw new Error(\n        'The inspected token doesn\\'t appear to be a JWT. '\n        + 'Check to make sure it has three parts and see https://jwt.io for more.'\n      );\n    }\n\n    const decoded = this.urlBase64Decode(parts[1]);\n    if (!decoded) {\n      throw new Error('Cannot decode the token.');\n    }\n\n    return JSON.parse(decoded);\n  }\n\n  getTokenExpirationDate(token: string | null = this.tokenGetter()): Date | null {\n    let decoded: any;\n    decoded = this.decodeToken(token);\n\n    if (!decoded.hasOwnProperty('exp')) {\n      return null;\n    }\n\n    const date = new Date(0);\n    date.setUTCSeconds(decoded.exp);\n\n    return date;\n  }\n\n  isTokenExpired(token: string | null = this.tokenGetter(), offsetSeconds?: number): boolean {\n    if (token === null || token === '') {\n        return true;\n    }\n    const date = this.getTokenExpirationDate(token);\n    offsetSeconds = offsetSeconds || 0;\n\n    if (date === null) {\n      return true;\n    }\n\n    return !(date.valueOf() > new Date().valueOf() + offsetSeconds * 1000);\n  }\n}\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {InjectionToken} from '@angular/core';\n\nimport {JwtOptions} from './jwt-options';\n\n\nexport const JWT_OPTIONS = new InjectionToken<JwtOptions>('JWT_OPTIONS', {\n  providedIn: 'root',\n  factory: () => ({})\n});\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {InjectionToken} from '@angular/core';\n\nimport {AuthOptions} from './auth-options';\n\n\nexport const AUTH_OPTIONS: InjectionToken<AuthOptions> =\n  new InjectionToken<AuthOptions>('AUTH_OPTIONS', {\n    providedIn: 'root',\n    factory: () => ({\n      loginUrl: '/login',\n      logoutUrl: '/logout',\n      refreshTokenUrl: '/refresh_token',\n      meUrl: '/me'\n    })\n  });\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {\n  createSelector, createFeatureSelector, ActionReducerMap, MemoizedSelector\n} from '@ngrx/store';\n\nimport * as fromRoot from '@gngt/core/reducers';\nimport * as fromAuth from './auth-reducer';\nimport * as fromLoginPage from './login-page-reducer';\nimport {AuthApiActionsUnion} from './auth-api-actions';\nimport {User} from './user';\n\nexport interface AuthState {\n  status: fromAuth.State;\n  loginPage: fromLoginPage.State;\n}\n\nexport interface State extends fromRoot.State {\n  auth: AuthState;\n}\n\nexport const reducers: ActionReducerMap<AuthState, AuthApiActionsUnion> = {\n  status: fromAuth.reducer,\n  loginPage: fromLoginPage.reducer,\n};\n\nexport const selectAuthState = createFeatureSelector<State, AuthState>('auth');\n\nexport const selectAuthStatusState = createSelector(\n  selectAuthState,\n  (state: AuthState) => state.status\n);\nexport const getInit = createSelector(selectAuthStatusState, fromAuth.getInit);\nexport const getUser: MemoizedSelector<State, User | null> =\n  createSelector(selectAuthStatusState, fromAuth.getUser);\nexport const getLoggedIn = createSelector(getUser, user => user != null);\n\nexport const selectLoginPageState = createSelector(\n  selectAuthState,\n  (state: AuthState) => state.loginPage\n);\nexport const getLoginPageError = createSelector(\n  selectLoginPageState,\n  fromLoginPage.getError\n);\nexport const getLoginPagePending = createSelector(\n  selectLoginPageState,\n  fromLoginPage.getPending\n);\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AuthApiActionTypes, AuthApiActionsUnion} from './auth-api-actions';\nimport {LoginPageActionTypes, LoginPageActionsUnion} from './login-page-actions';\n\nexport interface State {\n  error: string | null;\n  pending: boolean;\n}\n\nexport const initialState: State = {\n  error: null,\n  pending: false,\n};\n\nexport function reducer(\n  state = initialState,\n  action: AuthApiActionsUnion | LoginPageActionsUnion\n): State {\n  switch (action.type) {\n    case LoginPageActionTypes.Login: {\n      return {\n        ...state,\n        error: null,\n        pending: true,\n      };\n    }\n\n    case AuthApiActionTypes.LoginSuccess: {\n      return {\n        ...state,\n        error: null,\n        pending: false,\n      };\n    }\n\n    case AuthApiActionTypes.LoginFailure: {\n      return {\n        ...state,\n        error: action.payload.error,\n        pending: false,\n      };\n    }\n\n    default: {\n      return state;\n    }\n  }\n}\n\nexport const getError = (state: State) => state.error;\nexport const getPending = (state: State) => state.pending;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\nimport {Credentials} from './credentials';\n\nexport enum LoginPageActionTypes {\n  Login = '[Login Page] Login',\n}\n\nexport class Login implements Action {\n  readonly type = LoginPageActionTypes.Login;\n\n  constructor(public payload: { credentials: Credentials }) {}\n}\n\nexport type LoginPageActionsUnion = Login;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {AuthApiActionsUnion, AuthApiActionTypes} from './auth-api-actions';\nimport * as AuthActions from './auth-actions';\nimport {User} from './user';\n\nexport interface State {\n  init: boolean;\n  user: User | null;\n  token: string | null;\n}\n\nexport const initialState: State = {\n  init: false,\n  user: null,\n  token: null\n};\n\nexport function reducer(\n  state = initialState,\n  action: AuthApiActionsUnion | AuthActions.AuthActionsUnion\n): State {\n  switch (action.type) {\n    case AuthApiActionTypes.LoginSuccess: {\n      return {\n        ...state,\n        user: action.payload.user,\n      };\n    }\n\n    case AuthActions.AuthActionTypes.Logout: {\n      return initialState;\n    }\n\n    case AuthActions.AuthActionTypes.InitUserComplete: {\n      return {\n        ...state,\n        init: true,\n        user: action.payload.user\n      };\n    }\n\n    case AuthActions.AuthActionTypes.InitComplete: {\n      return {\n        ...state,\n        init: true\n      };\n    }\n\n    default: {\n      return state;\n    }\n  }\n}\n\nexport const getInit = (state: State) => state.init;\nexport const getUser = (state: State) => state.user;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\n\nimport {User} from './user';\n\n\nexport enum AuthActionTypes {\n  InitUser = '[Auth] Init user',\n  InitUserComplete = '[Auth] Init user complete',\n  InitComplete = '[Auth] Init complete',\n  Logout = '[Auth] Logout',\n  LogoutConfirmation = '[Auth] Logout Confirmation',\n  LogoutConfirmationDismiss = '[Auth] Logout Confirmation Dismiss',\n}\n\nexport class InitUser implements Action {\n  readonly type = AuthActionTypes.InitUser;\n}\n\nexport class InitUserComplete implements Action {\n  readonly type = AuthActionTypes.InitUserComplete;\n\n  constructor(public payload: { user: User | null }) {}\n}\n\nexport class InitComplete implements Action {\n  readonly type = AuthActionTypes.InitComplete;\n}\n\nexport class Logout implements Action {\n  readonly type = AuthActionTypes.Logout;\n}\n\nexport class LogoutConfirmation implements Action {\n  readonly type = AuthActionTypes.LogoutConfirmation;\n}\n\nexport class LogoutConfirmationDismiss implements Action {\n  readonly type = AuthActionTypes.LogoutConfirmationDismiss;\n}\n\nexport type AuthActionsUnion =\n  | InitUser\n  | InitUserComplete\n  | InitComplete\n  | Logout\n  | LogoutConfirmation\n  | LogoutConfirmationDismiss;\n","/**\n * @license\n * Copyright (C) 2018 Gnucoop soc. coop.\n *\n * This file is part of the Gnucoop Angular Toolkit (gngt).\n *\n * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.\n *\n */\n\nimport {Action} from '@ngrx/store';\nimport {LoginResponse} from './login-response';\n\nexport enum AuthApiActionTypes {\n  LoginSuccess = '[Auth/API] Login Success',\n  LoginFailure = '[Auth/API] Login Failure',\n  LoginRedirect = '[Auth/API] Login Redirect',\n  RefreshToken= '[Auth/API] Refresh token'\n}\n\nexport class LoginSuccess implements Action {\n  readonly type = AuthApiActionTypes.LoginSuccess;\n\n  constructor(public payload: LoginResponse) {}\n}\n\nexport class LoginFailure implements Action {\n  readonly type = AuthApiActionTypes.LoginFailure;\n\n  constructor(public payload: { error: any }) {}\n}\n\nexport class LoginRedirect implements Action {\n  readonly type = AuthApiActionTypes.LoginRedirect;\n}\n\nexport class RefreshToken implements Action {\n  readonly type = AuthApiActionTypes.RefreshToken;\n\n  constructor(public payload: { refreshDelay: number, fromInit?: boolean }) {}\n}\n\nexport type AuthApiActionsUnion =\n  | LoginSuccess\n  | LoginFailure\n  | LoginRedirect\n  | RefreshToken;\n"],"names":["tslib_1.__decorate","AuthApiActions.RefreshToken","AuthActions.InitComplete","AuthActions.InitUser","obsOf","AuthActions.LogoutConfirmationDismiss","AuthActions.Logout","AuthActions.AuthActionTypes","AuthApiActions.AuthApiActionTypes","AuthApiActions.LoginFailure","AuthApiActions.LoginSuccess","LoginPageActions.LoginPageActionTypes","AuthActions.InitUserComplete","LoginPageActions.Login","AuthApiActions.LoginRedirect","fromAuth.getLoggedIn","fromAuth.getInit","fromLoginPage.getPending","fromLoginPage.getError","getUser","fromAuth.getUser","getInit","fromLoginPage.reducer","fromAuth.reducer","reducer","initialState"],"mappings":"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"}