/**
 * @license
 * Copyright (C) Gnucoop soc. coop.
 *
 * This file is part of the Gnucoop Angular Toolkit (gngt).
 *
 * Gnucoop Angular Toolkit (gngt) is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Gnucoop Angular Toolkit (gngt) is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Gnucoop Angular Toolkit (gngt).  If not, see http://www.gnu.org/licenses/.
 *
 */
import { createEffect, ofType } from '@ngrx/effects';
import { of as obsOf } from 'rxjs';
import { catchError, map, mergeMap } from 'rxjs/operators';
import { createAction } from './utils';
export class ModelEffects {
    constructor(_actions, _service, _manager, _actionTypes) {
        this._actions = _actions;
        this._service = _service;
        this._manager = _manager;
        this._actionTypes = _actionTypes;
        this.modelGet$ = createEffect(() => this._actions.pipe(ofType(this._actionTypes.GET), mergeMap(action => this._manager.get(action.payload.id)
            .pipe(map((item) => createAction({
            type: this._actionTypes.GET_SUCCESS,
            payload: { item },
            uuid: action.uuid
        })), catchError(error => obsOf(createAction({
            type: this._actionTypes.GET_FAILURE,
            payload: { message: error.message, stack: error.stack },
            uuid: action.uuid
        })))))));
        this.modelList$ = createEffect(() => this._actions.pipe(ofType(this._actionTypes.LIST), mergeMap(action => this._manager.list(action.payload.params)
            .pipe(map((result) => createAction({
            type: this._actionTypes.LIST_SUCCESS,
            payload: { result },
            uuid: action.uuid
        })), catchError(error => obsOf(createAction({
            type: this._actionTypes.LIST_FAILURE,
            payload: { message: error.message, stack: error.stack },
            uuid: action.uuid
        })))))));
        this.modelCreate$ = createEffect(() => this._actions.pipe(ofType(this._actionTypes.CREATE), mergeMap(action => this._manager.create(action.payload.item)
            .pipe(map((item) => createAction({
            type: this._actionTypes.CREATE_SUCCESS,
            payload: { item },
            uuid: action.uuid
        })), catchError(error => obsOf(createAction({
            type: this._actionTypes.CREATE_FAILURE,
            payload: { message: error.message, stack: error.stack },
            uuid: action.uuid
        })))))));
        this.modelUpdate$ = createEffect(() => this._actions.pipe(ofType(this._actionTypes.UPDATE), mergeMap(action => this._manager.update(action.payload.item.id, action.payload.item)
            .pipe(map((item) => createAction({
            type: this._actionTypes.UPDATE_SUCCESS,
            payload: { item },
            uuid: action.uuid
        })), catchError(error => obsOf(createAction({
            type: this._actionTypes.CREATE_FAILURE,
            payload: { message: error.message, stack: error.stack },
            uuid: action.uuid
        })))))));
        this.modelPatch$ = createEffect(() => this._actions.pipe(ofType(this._actionTypes.PATCH), mergeMap(action => this._manager.patch(action.payload.item.id, action.payload.item)
            .pipe(map((item) => createAction({
            type: this._actionTypes.PATCH_SUCCESS,
            payload: { item },
            uuid: action.uuid
        })), catchError(error => obsOf(createAction({
            type: this._actionTypes.PATCH_FAILURE,
            payload: { message: error.message, stack: error.stack },
            uuid: action.uuid
        })))))));
        this.modelDelete$ = createEffect(() => this._actions.pipe(ofType(this._actionTypes.DELETE), mergeMap(action => this._manager.delete(action.payload.item.id)
            .pipe(map(() => createAction({
            type: this._actionTypes.DELETE_SUCCESS,
            payload: { item: action.payload.item },
            uuid: action.uuid
        })), catchError(error => obsOf(createAction({
            type: this._actionTypes.DELETE_FAILURE,
            payload: { message: error.message, stack: error.stack },
            uuid: action.uuid
        })))))));
        this.modelDeleteAll$ = createEffect(() => this._actions.pipe(ofType(this._actionTypes.DELETE_ALL), mergeMap(action => this._manager.deleteAll(action.payload.items.map(i => i.id))
            .pipe(map(() => createAction({
            type: this._actionTypes.DELETE_ALL_SUCCESS,
            payload: { items: action.payload.items },
            uuid: action.uuid
        })), catchError(error => obsOf(createAction({
            type: this._actionTypes.DELETE_ALL_FAILURE,
            payload: { message: error.message, stack: error.stack },
            uuid: action.uuid
        })))))));
        this.modelQuery$ = createEffect(() => this._actions.pipe(ofType(this._actionTypes.QUERY), mergeMap(action => this._manager.query(action.payload.params)
            .pipe(map((result) => createAction({
            type: this._actionTypes.QUERY_SUCCESS,
            payload: { result },
            uuid: action.uuid
        })), catchError(error => obsOf(createAction({
            type: this._actionTypes.QUERY_FAILURE,
            payload: { message: error.message, stack: error.stack },
            uuid: action.uuid
        })))))));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwtZWZmZWN0cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb3JlL21vZGVsL21vZGVsLWVmZmVjdHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FtQkc7QUFHSCxPQUFPLEVBQVUsWUFBWSxFQUF3QixNQUFNLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFhLEVBQUUsSUFBSSxLQUFLLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFDN0MsT0FBTyxFQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFpQnpELE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxTQUFTLENBQUM7QUFFckMsTUFBTSxPQUFnQixZQUFZO0lBNExoQyxZQUNjLFFBQWlCLEVBQ2pCLFFBQWdDLEVBQ2hDLFFBQXlCLEVBQzNCLFlBQWdCO1FBSGQsYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUNqQixhQUFRLEdBQVIsUUFBUSxDQUF3QjtRQUNoQyxhQUFRLEdBQVIsUUFBUSxDQUFpQjtRQUMzQixpQkFBWSxHQUFaLFlBQVksQ0FBSTtRQTdMVCxjQUFTLEdBQ3hCLFlBQVksQ0FDUixHQUFHLEVBQUUsQ0FDRCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDZCxNQUFNLENBQWlCLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLEVBQzdDLFFBQVEsQ0FDSixNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2FBQy9CLElBQUksQ0FDRCxHQUFHLENBQUMsQ0FBQyxJQUFPLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQztZQUN4QixJQUFJLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXO1lBQ25DLE9BQU8sRUFBRSxFQUFDLElBQUksRUFB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QyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQzthQUNyQyxJQUFJLENBQ0QsR0FBRyxDQUFDLENBQUMsTUFBMEIsRUFBRSxFQUFFLENBQUMsWUFBWSxDQUFDO1lBQzNDLElBQUksRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWE7WUFDckMsT0FBTyxFQUFFLEVBQUMsTUFBTSxFQUFDO1lBQ2pCLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSTtTQUNsQixDQUFDLENBQUMsRUFDUCxVQUFVLENBQ04sS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDO1lBQzFCLElBQUksRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWE7WUFDckMsT0FBTyxFQUFFLEVBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUM7WUFDckQsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJO1NBQ2xCLENBQUMsQ0FBQyxDQUFDLENBQ1AsQ0FDbEIsQ0FDOEIsQ0FDM0IsQ0FBQztJQU90QixDQUFDO0NBQ0wiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgKEMpIEdudWNvb3Agc29jLiBjb29wLlxuICpcbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIHRoZSBHbnVjb29wIEFuZ3VsYXIgVG9vbGtpdCAoZ25ndCkuXG4gKlxuICogR251Y29vcCBBbmd1bGFyIFRvb2xraXQgKGduZ3QpIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBHbnVjb29wIEFuZ3VsYXIgVG9vbGtpdCAoZ25ndCkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG4gKiBhbG9uZyB3aXRoIEdudWNvb3AgQW5ndWxhciBUb29sa2l0IChnbmd0KS4gIElmIG5vdCwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8uXG4gKlxuICovXG5cbmltcG9ydCB7TW9kZWwsIE1vZGVsTGlzdFJlc3VsdH0gZnJvbSAnQGduZ3QvY29yZS9jb21tb24nO1xuaW1wb3J0IHtBY3Rpb25zLCBjcmVhdGVFZmZlY3QsIENyZWF0ZUVmZmVjdE1ldGFkYXRhLCBvZlR5cGV9IGZyb20gJ0BuZ3J4L2VmZmVjdHMnO1xuaW1wb3J0IHtPYnNlcnZhYmxlLCBvZiBhcyBvYnNPZn0gZnJvbSAncnhqcyc7XG5pbXBvcnQge2NhdGNoRXJyb3IsIG1hcCwgbWVyZ2VNYXB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHtcbiAgTW9kZWxBY3Rpb25UeXBlcyxcbiAgTW9kZWxDcmVhdGVBY3Rpb24sXG4gIE1vZGVsRGVsZXRlQWN0aW9uLFxuICBNb2RlbERlbGV0ZUFsbEFjdGlvbixcbiAgTW9kZWxHZXRBY3Rpb24sXG4gIE1vZGVsTGlzdEFjdGlvbixcbiAgTW9kZWxQYXRjaEFjdGlvbixcbiAgTW9kZWxRdWVyeUFjdGlvbixcbiAgTW9kZWxVcGRhdGVBY3Rpb24sXG59IGZyb20gJy4vbW9kZWwtYWN0aW9ucyc7XG5pbXBvcnQge01vZGVsR2VuZXJpY0FjdGlvbn0gZnJvbSAnLi9tb2RlbC1nZW5lcmljLWFjdGlvbic7XG5pbXBvcnQge01vZGVsTWFuYWdlcn0gZnJvbSAnLi9tb2RlbC1tYW5hZ2VyJztcbmltcG9ydCAqIGFzIGZyb21Nb2RlbCBmcm9tICcuL21vZGVsLXJlZHVjZXInO1xuaW1wb3J0IHtNb2RlbFNlcnZpY2V9IGZyb20gJy4vbW9kZWwtc2VydmljZSc7XG5pbXBvcnQge2NyZWF0ZUFjdGlvbn0gZnJvbSAnLi91dGlscyc7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBNb2RlbEVmZmVjdHM8XG4gICAgTSBleHRlbmRzIE1vZGVsID0gTW9kZWwsIFMgZXh0ZW5kcyBmcm9tTW9kZWwuU3RhdGU8TT4gPSBmcm9tTW9kZWwuU3RhdGU8TT4sIEEgZXh0ZW5kc1xuICAgICAgICBNb2RlbEdlbmVyaWNBY3Rpb24gPSBNb2RlbEdlbmVyaWNBY3Rpb24sIEFUIGV4dGVuZHMgTW9kZWxBY3Rpb25UeXBlcyA9IE1vZGVsQWN0aW9uVHlwZXM+IHtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IG1vZGVsR2V0JCA9XG4gICAgICBjcmVhdGVFZmZlY3QoXG4gICAgICAgICAgKCkgPT5cbiAgICAgICAgICAgICAgdGhpcy5fYWN0aW9ucy5waXBlKFxuICAgICAgICAgICAgICAgICAgb2ZUeXBlPE1vZGVsR2V0QWN0aW9uPih0aGlzLl9hY3Rpb25UeXBlcy5HRVQpLFxuICAgICAgICAgICAgICAgICAgbWVyZ2VNYXAoXG4gICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0+IHRoaXMuX21hbmFnZXIuZ2V0KGFjdGlvbi5wYXlsb2FkLmlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwKChpdGVtOiBNKSA9PiBjcmVhdGVBY3Rpb24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMuX2FjdGlvblR5cGVzLkdFVF9TVUNDRVNTLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHtpdGVtfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBhY3Rpb24udXVpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2hFcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPT4gb2JzT2YoY3JlYXRlQWN0aW9uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLl9hY3Rpb25UeXBlcy5HRVRfRkFJTFVSRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7bWVzc2FnZTogZXJyb3IubWVzc2FnZSwgc3RhY2s6IGVycm9yLnN0YWNrfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBhY3Rpb24udXVpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpLFxuICAgICAgICAgICAgICAgICAgKSBhcyBPYnNlcnZhYmxlPE1vZGVsR2VuZXJpY0FjdGlvbj4pIGFzIE9ic2VydmFibGU8QT4mXG4gICAgICBDcmVhdGVFZmZlY3RNZXRhZGF0YTtcblxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgbW9kZWxMaXN0JCA9XG4gICAgICBjcmVhdGVFZmZlY3QoXG4gICAgICAgICAgKCkgPT5cbiAgICAgICAgICAgICAgdGhpcy5fYWN0aW9ucy5waXBlKFxuICAgICAgICAgICAgICAgICAgb2ZUeXBlPE1vZGVsTGlzdEFjdGlvbj4odGhpcy5fYWN0aW9uVHlwZXMuTElTVCksXG4gICAgICAgICAgICAgICAgICBtZXJnZU1hcChcbiAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPT4gdGhpcy5fbWFuYWdlci5saXN0KGFjdGlvbi5wYXlsb2FkLnBhcmFtcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcCgocmVzdWx0OiBNb2RlbExpc3RSZXN1bHQ8TT4pID0+IGNyZWF0ZUFjdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy5fYWN0aW9uVHlwZXMuTElTVF9TVUNDRVNTLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHtyZXN1bHR9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IGFjdGlvbi51dWlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaEVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9PiBvYnNPZihjcmVhdGVBY3Rpb24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMuX2FjdGlvblR5cGVzLkxJU1RfRkFJTFVSRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7bWVzc2FnZTogZXJyb3IubWVzc2FnZSwgc3RhY2s6IGVycm9yLnN0YWNrfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBhY3Rpb24udXVpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpLFxuICAgICAgICAgICAgICAgICAgKSBhcyBPYnNlcnZhYmxlPE1vZGVsR2VuZXJpY0FjdGlvbj4pIGFzIE9ic2VydmFibGU8QT4mXG4gICAgICBDcmVhdGVFZmZlY3RNZXRhZGF0YTtcblxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgbW9kZWxDcmVhdGUkID1cbiAgICAgIGNyZWF0ZUVmZmVjdChcbiAgICAgICAgICAoKSA9PlxuICAgICAgICAgICAgICB0aGlzLl9hY3Rpb25zLnBpcGUoXG4gICAgICAgICAgICAgICAgICBvZlR5cGU8TW9kZWxDcmVhdGVBY3Rpb248TT4+KHRoaXMuX2FjdGlvblR5cGVzLkNSRUFURSksXG4gICAgICAgICAgICAgICAgICBtZXJnZU1hcChcbiAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPT4gdGhpcy5fbWFuYWdlci5jcmVhdGUoYWN0aW9uLnBheWxvYWQuaXRlbSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcCgoaXRlbTogTSkgPT4gY3JlYXRlQWN0aW9uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLl9hY3Rpb25UeXBlcy5DUkVBVEVfU1VDQ0VTUyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7aXRlbX0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogYWN0aW9uLnV1aWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0+IG9ic09mKGNyZWF0ZUFjdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy5fYWN0aW9uVHlwZXMuQ1JFQVRFX0ZBSUxVUkUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZDoge21lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsIHN0YWNrOiBlcnJvci5zdGFja30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogYWN0aW9uLnV1aWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKSxcbiAgICAgICAgICAgICAgICAgICkgYXMgT2JzZXJ2YWJsZTxNb2RlbEdlbmVyaWNBY3Rpb24+KSBhcyBPYnNlcnZhYmxlPEE+JlxuICAgICAgQ3JlYXRlRWZmZWN0TWV0YWRhdGE7XG5cbiAgcHJvdGVjdGVkIHJlYWRvbmx5IG1vZGVsVXBkYXRlJCA9XG4gICAgICBjcmVhdGVFZmZlY3QoXG4gICAgICAgICAgKCkgPT5cbiAgICAgICAgICAgICAgdGhpcy5fYWN0aW9ucy5waXBlKFxuICAgICAgICAgICAgICAgICAgb2ZUeXBlPE1vZGVsVXBkYXRlQWN0aW9uPE0+Pih0aGlzLl9hY3Rpb25UeXBlcy5VUERBVEUpLFxuICAgICAgICAgICAgICAgICAgbWVyZ2VNYXAoXG4gICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0+IHRoaXMuX21hbmFnZXIudXBkYXRlKGFjdGlvbi5wYXlsb2FkLml0ZW0uaWQsIGFjdGlvbi5wYXlsb2FkLml0ZW0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAoKGl0ZW06IE0pID0+IGNyZWF0ZUFjdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy5fYWN0aW9uVHlwZXMuVVBEQVRFX1NVQ0NFU1MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZDoge2l0ZW19LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IGFjdGlvbi51dWlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaEVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9PiBvYnNPZihjcmVhdGVBY3Rpb24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMuX2FjdGlvblR5cGVzLkNSRUFURV9GQUlMVVJFLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHttZXNzYWdlOiBlcnJvci5tZXNzYWdlLCBzdGFjazogZXJyb3Iuc3RhY2t9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IGFjdGlvbi51dWlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSksXG4gICAgICAgICAgICAgICAgICApIGFzIE9ic2VydmFibGU8TW9kZWxHZW5lcmljQWN0aW9uPikgYXMgT2JzZXJ2YWJsZTxBPiZcbiAgICAgIENyZWF0ZUVmZmVjdE1ldGFkYXRhO1xuXG4gIHByb3RlY3RlZCByZWFkb25seSBtb2RlbFBhdGNoJCA9XG4gICAgICBjcmVhdGVFZmZlY3QoXG4gICAgICAgICAgKCkgPT5cbiAgICAgICAgICAgICAgdGhpcy5fYWN0aW9ucy5waXBlKFxuICAgICAgICAgICAgICAgICAgb2ZUeXBlPE1vZGVsUGF0Y2hBY3Rpb248TT4+KHRoaXMuX2FjdGlvblR5cGVzLlBBVENIKSxcbiAgICAgICAgICAgICAgICAgIG1lcmdlTWFwKFxuICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9PiB0aGlzLl9tYW5hZ2VyLnBhdGNoKGFjdGlvbi5wYXlsb2FkLml0ZW0uaWQsIGFjdGlvbi5wYXlsb2FkLml0ZW0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAoKGl0ZW06IE0pID0+IGNyZWF0ZUFjdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy5fYWN0aW9uVHlwZXMuUEFUQ0hfU1VDQ0VTUyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7aXRlbX0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogYWN0aW9uLnV1aWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0+IG9ic09mKGNyZWF0ZUFjdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy5fYWN0aW9uVHlwZXMuUEFUQ0hfRkFJTFVSRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7bWVzc2FnZTogZXJyb3IubWVzc2FnZSwgc3RhY2s6IGVycm9yLnN0YWNrfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBhY3Rpb24udXVpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpLFxuICAgICAgICAgICAgICAgICAgKSBhcyBPYnNlcnZhYmxlPE1vZGVsR2VuZXJpY0FjdGlvbj4pIGFzIE9ic2VydmFibGU8QT4mXG4gICAgICBDcmVhdGVFZmZlY3RNZXRhZGF0YTtcblxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgbW9kZWxEZWxldGUkID1cbiAgICAgIGNyZWF0ZUVmZmVjdChcbiAgICAgICAgICAoKSA9PlxuICAgICAgICAgICAgICB0aGlzLl9hY3Rpb25zLnBpcGUoXG4gICAgICAgICAgICAgICAgICBvZlR5cGU8TW9kZWxEZWxldGVBY3Rpb248TT4+KHRoaXMuX2FjdGlvblR5cGVzLkRFTEVURSksXG4gICAgICAgICAgICAgICAgICBtZXJnZU1hcChcbiAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPT4gdGhpcy5fbWFuYWdlci5kZWxldGUoYWN0aW9uLnBheWxvYWQuaXRlbS5pZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcCgoKSA9PiBjcmVhdGVBY3Rpb24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMuX2FjdGlvblR5cGVzLkRFTEVURV9TVUNDRVNTLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHtpdGVtOiBhY3Rpb24ucGF5bG9hZC5pdGVtfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBhY3Rpb24udXVpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2hFcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPT4gb2JzT2YoY3JlYXRlQWN0aW9uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLl9hY3Rpb25UeXBlcy5ERUxFVEVfRkFJTFVSRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7bWVzc2FnZTogZXJyb3IubWVzc2FnZSwgc3RhY2s6IGVycm9yLnN0YWNrfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBhY3Rpb24udXVpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpLFxuICAgICAgICAgICAgICAgICAgKSBhcyBPYnNlcnZhYmxlPE1vZGVsR2VuZXJpY0FjdGlvbj4pIGFzIE9ic2VydmFibGU8QT4mXG4gICAgICBDcmVhdGVFZmZlY3RNZXRhZGF0YTtcblxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgbW9kZWxEZWxldGVBbGwkID1cbiAgICAgIGNyZWF0ZUVmZmVjdChcbiAgICAgICAgICAoKSA9PlxuICAgICAgICAgICAgICB0aGlzLl9hY3Rpb25zLnBpcGUoXG4gICAgICAgICAgICAgICAgICBvZlR5cGU8TW9kZWxEZWxldGVBbGxBY3Rpb248TT4+KHRoaXMuX2FjdGlvblR5cGVzLkRFTEVURV9BTEwpLFxuICAgICAgICAgICAgICAgICAgbWVyZ2VNYXAoXG4gICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0+IHRoaXMuX21hbmFnZXIuZGVsZXRlQWxsKGFjdGlvbi5wYXlsb2FkLml0ZW1zLm1hcChpID0+IGkuaWQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwKCgpID0+IGNyZWF0ZUFjdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy5fYWN0aW9uVHlwZXMuREVMRVRFX0FMTF9TVUNDRVNTLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHtpdGVtczogYWN0aW9uLnBheWxvYWQuaXRlbXN9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IGFjdGlvbi51dWlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaEVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9PiBvYnNPZihjcmVhdGVBY3Rpb24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMuX2FjdGlvblR5cGVzLkRFTEVURV9BTExfRkFJTFVSRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7bWVzc2FnZTogZXJyb3IubWVzc2FnZSwgc3RhY2s6IGVycm9yLnN0YWNrfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBhY3Rpb24udXVpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpLFxuICAgICAgICAgICAgICAgICAgKSBhcyBPYnNlcnZhYmxlPE1vZGVsR2VuZXJpY0FjdGlvbj4pIGFzIE9ic2VydmFibGU8QT4mXG4gICAgICBDcmVhdGVFZmZlY3RNZXRhZGF0YTtcblxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgbW9kZWxRdWVyeSQgPVxuICAgICAgY3JlYXRlRWZmZWN0KFxuICAgICAgICAgICgpID0+XG4gICAgICAgICAgICAgIHRoaXMuX2FjdGlvbnMucGlwZShcbiAgICAgICAgICAgICAgICAgIG9mVHlwZTxNb2RlbFF1ZXJ5QWN0aW9uPih0aGlzLl9hY3Rpb25UeXBlcy5RVUVSWSksXG4gICAgICAgICAgICAgICAgICBtZXJnZU1hcChcbiAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPT4gdGhpcy5fbWFuYWdlci5xdWVyeShhY3Rpb24ucGF5bG9hZC5wYXJhbXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAoKHJlc3VsdDogTW9kZWxMaXN0UmVzdWx0PE0+KSA9PiBjcmVhdGVBY3Rpb24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMuX2FjdGlvblR5cGVzLlFVRVJZX1NVQ0NFU1MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZDoge3Jlc3VsdH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZDogYWN0aW9uLnV1aWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0+IG9ic09mKGNyZWF0ZUFjdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy5fYWN0aW9uVHlwZXMuUVVFUllfRkFJTFVSRSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiB7bWVzc2FnZTogZXJyb3IubWVzc2FnZSwgc3RhY2s6IGVycm9yLnN0YWNrfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkOiBhY3Rpb24udXVpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICkgYXMgT2JzZXJ2YWJsZTxNb2RlbEdlbmVyaWNBY3Rpb24+KSBhcyBPYnNlcnZhYmxlPEE+JlxuICAgICAgQ3JlYXRlRWZmZWN0TWV0YWRhdGE7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgICBwcm90ZWN0ZWQgX2FjdGlvbnM6IEFjdGlvbnMsXG4gICAgICBwcm90ZWN0ZWQgX3NlcnZpY2U6IE1vZGVsU2VydmljZTxNLCBTLCBBVD4sXG4gICAgICBwcm90ZWN0ZWQgX21hbmFnZXI6IE1vZGVsTWFuYWdlcjxNPixcbiAgICAgIHByaXZhdGUgX2FjdGlvblR5cGVzOiBBVCxcbiAgKSB7fVxufVxuIl19